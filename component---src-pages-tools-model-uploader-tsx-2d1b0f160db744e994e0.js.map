{"version":3,"file":"component---src-pages-tools-model-uploader-tsx-2d1b0f160db744e994e0.js","mappings":"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","sources":["webpack://jacdac-docs/./node_modules/@mui/material/CardActions/cardActionsClasses.js","webpack://jacdac-docs/./node_modules/@mui/material/CardActions/CardActions.js","webpack://jacdac-docs/./jacdac-ts/src/clients/sensoraggregatorclient.ts","webpack://jacdac-docs/./src/components/alert/ConnectAlert.tsx","webpack://jacdac-docs/./src/components/devices/DeviceCardMedia.tsx","webpack://jacdac-docs/./src/components/devices/DeviceCardHeader.tsx","webpack://jacdac-docs/./src/components/ui/CircularProgressWithLabel.tsx","webpack://jacdac-docs/./src/components/useGridBreakpoints.ts","webpack://jacdac-docs/./src/components/ServiceList.tsx","webpack://jacdac-docs/./src/components/useDb.ts","webpack://jacdac-docs/./jacdac-ts/src/clients/modelrunnerclient.ts","webpack://jacdac-docs/./src/components/SensorAggregatorConfigView.tsx","webpack://jacdac-docs/./src/components/useCall.tsx","webpack://jacdac-docs/./node_modules/@mui/icons-material/esm/Link.js","webpack://jacdac-docs/./src/pages/tools/model-uploader.tsx"],"sourcesContent":["import { generateUtilityClass, generateUtilityClasses } from '@mui/base';\nexport function getCardActionsUtilityClass(slot) {\n  return generateUtilityClass('MuiCardActions', slot);\n}\nvar cardActionsClasses = generateUtilityClasses('MuiCardActions', ['root', 'spacing']);\nexport default cardActionsClasses;","import _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nvar _excluded = [\"disableSpacing\", \"className\"];\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport { unstable_composeClasses as composeClasses } from '@mui/base';\nimport styled from '../styles/styled';\nimport useThemeProps from '../styles/useThemeProps';\nimport { getCardActionsUtilityClass } from './cardActionsClasses';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nvar useUtilityClasses = ownerState => {\n  var {\n    classes,\n    disableSpacing\n  } = ownerState;\n  var slots = {\n    root: ['root', !disableSpacing && 'spacing']\n  };\n  return composeClasses(slots, getCardActionsUtilityClass, classes);\n};\n\nvar CardActionsRoot = styled('div', {\n  name: 'MuiCardActions',\n  slot: 'Root',\n  overridesResolver: (props, styles) => {\n    var {\n      ownerState\n    } = props;\n    return [styles.root, !ownerState.disableSpacing && styles.spacing];\n  }\n})(_ref => {\n  var {\n    ownerState\n  } = _ref;\n  return _extends({\n    display: 'flex',\n    alignItems: 'center',\n    padding: 8\n  }, !ownerState.disableSpacing && {\n    '& > :not(:first-of-type)': {\n      marginLeft: 8\n    }\n  });\n});\nvar CardActions = /*#__PURE__*/React.forwardRef(function CardActions(inProps, ref) {\n  var props = useThemeProps({\n    props: inProps,\n    name: 'MuiCardActions'\n  });\n\n  var {\n    disableSpacing = false,\n    className\n  } = props,\n      other = _objectWithoutPropertiesLoose(props, _excluded);\n\n  var ownerState = _extends({}, props, {\n    disableSpacing\n  });\n\n  var classes = useUtilityClasses(ownerState);\n  return /*#__PURE__*/_jsx(CardActionsRoot, _extends({\n    className: clsx(classes.root, className),\n    ownerState: ownerState,\n    ref: ref\n  }, other));\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default CardActions;","import {\n    SensorAggregatorReg,\n    SensorAggregatorSampleType,\n    SRV_SENSOR_AGGREGATOR,\n} from \"../../jacdac-spec/dist/specconstants\"\nimport { bufferToArray, NumberFormat } from \"../jdom/buffer\"\nimport { JD_SERIAL_MAX_PAYLOAD_SIZE, REPORT_RECEIVE } from \"../jdom/constants\"\nimport { jdpack } from \"../jdom/pack\"\nimport JDRegister from \"../jdom/register\"\nimport JDService from \"../jdom/service\"\nimport { JDServiceClient } from \"../jdom/serviceclient\"\nimport {\n    isReading,\n    serviceSpecificationFromClassIdentifier,\n} from \"../jdom/spec\"\nimport { assert, bufferConcat, bufferConcatMany, fromHex } from \"../jdom/utils\"\n\nexport interface SensorAggregatorInputConfig {\n    serviceClass: number\n    // if specified, also specify serviceIndex\n    deviceId?: string\n    serviceIndex?: number\n}\n\nexport interface SensorAggregatorConfig {\n    samplingInterval: number // ms\n    samplesInWindow: number\n    inputs: SensorAggregatorInputConfig[]\n}\n\nexport interface SensorAggregatorStats {\n    numSamples: number\n    sampleSize: number\n}\n\n/**\n * A client for the sensor aggregator service\n * @category Clients\n */\nexport class SensorAggregatorClient extends JDServiceClient {\n    constructor(service: JDService) {\n        super(service)\n        assert(service.serviceClass === SRV_SENSOR_AGGREGATOR)\n        this.service.registersUseAcks = true\n    }\n\n    async setInputs(cfg: SensorAggregatorConfig) {\n        function error(msg: string) {\n            throw new Error(\"Aggregator inputs: \" + msg)\n        }\n        function mapType(tp: number) {\n            switch (tp) {\n                case 1:\n                    return SensorAggregatorSampleType.U8\n                case 2:\n                    return SensorAggregatorSampleType.U16\n                case 4:\n                    return SensorAggregatorSampleType.U32\n                case -1:\n                    return SensorAggregatorSampleType.I8\n                case -2:\n                    return SensorAggregatorSampleType.I16\n                case -4:\n                    return SensorAggregatorSampleType.I32\n                default:\n                    error(\"unknown storage type\")\n            }\n        }\n\n        if (!cfg || !cfg.inputs) error(\"invalid input format\")\n\n        let totalSampleSize = 0\n        const inputs = cfg.inputs?.map(input => {\n            const { deviceId, serviceIndex, serviceClass } = input\n            if (!!deviceId !== !!serviceIndex)\n                error(`deviceId and serviceIndex must be specified together`)\n            const specification =\n                serviceSpecificationFromClassIdentifier(serviceClass)\n            if (!specification)\n                error(\n                    `missing specification from service 0x${serviceClass.toString(\n                        16\n                    )}`\n                )\n            const freeze = !!deviceId\n            const readingReg = specification.packets.find(isReading)\n            if (!readingReg)\n                error(\n                    `service 0x${serviceClass.toString(\n                        16\n                    )} does not have a reading register`\n                )\n            let sampleType: SensorAggregatorSampleType = undefined\n            let sampleSize = 0\n            let sampleShift = 0\n            for (const field of readingReg.fields) {\n                sampleSize += Math.abs(field.storage)\n                if (sampleType === undefined) {\n                    sampleType = mapType(field.storage)\n                    sampleShift = field.shift || 0\n                }\n                if (\n                    sampleType != mapType(field.storage) ||\n                    sampleShift != (field.shift || 0)\n                )\n                    error(\"heterogenous field types\")\n            }\n            totalSampleSize += sampleSize\n            return bufferConcat(\n                freeze ? fromHex(deviceId) : new Uint8Array(8),\n                jdpack(\"u32 u8 u8 u8 i8\", [\n                    serviceClass,\n                    freeze ? serviceIndex : 0,\n                    sampleSize,\n                    sampleType,\n                    sampleShift,\n                ])\n            )\n        })\n\n        if (totalSampleSize > JD_SERIAL_MAX_PAYLOAD_SIZE)\n            error(\"samples won't fit in packet\")\n\n        // u32 is x[4]\n        inputs.unshift(\n            jdpack(\"u16 u16 u32\", [\n                cfg.samplingInterval,\n                cfg.samplesInWindow,\n                0,\n            ])\n        )\n        await this.service\n            .register(SensorAggregatorReg.Inputs)\n            .sendSetAsync(bufferConcatMany(inputs))\n    }\n\n    async collect(numSamples: number) {\n        await this.service\n            .register(SensorAggregatorReg.StreamingSamples)\n            .sendSetPackedAsync([numSamples])\n    }\n\n    subscribeSample(handler: (sample: number[]) => void): () => void {\n        const reg = this.service.register(SensorAggregatorReg.CurrentSample)\n        return this.mount(\n            reg.subscribe(REPORT_RECEIVE, () =>\n                handler(bufferToArray(reg.data, NumberFormat.Float32LE))\n            )\n        )\n    }\n\n    private async getReg(id: SensorAggregatorReg, f: (v: JDRegister) => any) {\n        const reg = this.service.register(id)\n        await reg.refresh()\n        return f(reg)\n    }\n\n    async stats(): Promise<SensorAggregatorStats> {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const info: any = {\n            numSamples: this.getReg(\n                SensorAggregatorReg.NumSamples,\n                r => r.intValue\n            ),\n            sampleSize: this.getReg(\n                SensorAggregatorReg.SampleSize,\n                r => r.intValue\n            ),\n        }\n        for (const id of Object.keys(info)) {\n            info[id] = await info[id]\n        }\n        return info\n    }\n}\nexport default SensorAggregatorClient\n","// tslint:disable-next-line: no-submodule-imports\nimport { Box } from \"@mui/material\"\n// tslint:disable-next-line: no-submodule-imports\nimport Alert from \"../ui/Alert\"\nimport React, { useContext } from \"react\"\nimport { serviceSpecificationFromClassIdentifier } from \"../../../jacdac-ts/src/jdom/spec\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport { NoSsr } from \"@mui/material\"\nimport ConnectButtons from \"../buttons/ConnectButtons\"\nimport useDevices from \"../hooks/useDevices\"\n\nfunction NoSsrConnectAlert(props: {\n    serviceClass?: number\n    closeable?: boolean\n}) {\n    const { serviceClass, closeable } = props\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { transports } = bus\n    const devices = useDevices({ serviceClass, ignoreInfrastructure: true })\n    const spec = serviceSpecificationFromClassIdentifier(serviceClass)\n\n    // don't show if no transport, some devices\n    if (!transports.length || devices?.length) return null\n\n    return (\n        <Box displayPrint=\"none\">\n            <Alert severity=\"info\" closeable={closeable}>\n                {!spec && <span>Did you connect your device?</span>}\n                {spec && <span>Did you connect a {spec.name} device?</span>}\n                <Box component=\"span\" ml={2}>\n                    <ConnectButtons full=\"always\" transparent={true} />\n                </Box>\n            </Alert>\n        </Box>\n    )\n}\n\nexport default function ConnectAlert(props: {\n    serviceClass?: number\n    closeable?: boolean\n}) {\n    return (\n        <NoSsr>\n            <NoSsrConnectAlert {...props} />\n        </NoSsr>\n    )\n}\n","import React from \"react\"\nimport JDDevice from \"../../../jacdac-ts/src/jdom/device\"\nimport useDeviceSpecification from \"../../jacdac/useDeviceSpecification\"\nimport useDeviceImage from \"./useDeviceImage\"\nimport CardMediaWithSkeleton from \"../ui/CardMediaWithSkeleton\"\n\nexport default function DeviceCardMedia(props: { device: JDDevice }) {\n    const { device } = props\n    const specification = useDeviceSpecification(device)\n    const imageUrl = useDeviceImage(specification, \"preview\")\n\n    return (\n        <CardMediaWithSkeleton image={imageUrl} title={specification?.name} />\n    )\n}\n","import {\n    ControlReg,\n    JD_SERVICE_INDEX_CTRL,\n} from \"../../../jacdac-ts/src/jdom/constants\"\nimport { CardHeader, Chip, Grid, Typography } from \"@mui/material\"\n// tslint:disable-next-line: no-submodule-imports\nimport { Link } from \"gatsby-theme-material-ui\"\nimport JDDevice from \"../../../jacdac-ts/src/jdom/device\"\nimport React from \"react\"\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\"\nimport DeviceActions from \"./DeviceActions\"\nimport DeviceName from \"./DeviceName\"\nimport DeviceCardMedia from \"./DeviceCardMedia\"\nimport useDeviceSpecification from \"../../jacdac/useDeviceSpecification\"\nimport { identifierToUrlPath } from \"../../../jacdac-ts/src/jdom/spec\"\nimport DeviceAvatar from \"./DeviceAvatar\"\nimport useChange from \"../../jacdac/useChange\"\nimport useRegister from \"../hooks/useRegister\"\n\nfunction DeviceFirmwareVersionChip(props: { device: JDDevice }) {\n    const { device } = props\n    const specification = useDeviceSpecification(device)\n    const control = useChange(device, _ => _?.service(JD_SERVICE_INDEX_CTRL))\n    const productIdentifierRegister = useRegister(\n        control,\n        ControlReg.ProductIdentifier\n    )\n    const [productIdentifier] = useRegisterUnpackedValue<[number]>(\n        productIdentifierRegister\n    )\n    const firmwareVersionRegister = useRegister(\n        control,\n        ControlReg.FirmwareVersion\n    )\n    const [firmwareVersion] = useRegisterUnpackedValue<[string]>(\n        firmwareVersionRegister\n    )\n    if (firmwareVersion == undefined) return null\n\n    const firmwareName =\n        !!productIdentifier &&\n        specification?.firmwares?.find(\n            fw => fw.productIdentifier === productIdentifier\n        )?.name\n\n    return (\n        <Chip\n            size=\"small\"\n            label={[firmwareName, firmwareVersion].filter(f => !!f).join(\" \")}\n        />\n    )\n}\n\nfunction DeviceTemperatureChip(props: { device: JDDevice }) {\n    const { device } = props\n    const tempRegister = useChange(device, _ =>\n        _?.service(0)?.register(ControlReg.McuTemperature)\n    )\n    const [temperature] = useRegisterUnpackedValue<[number]>(tempRegister)\n    if (isNaN(temperature)) return null\n    return <Chip size=\"small\" label={`${temperature}°`} />\n}\n\nexport default function DeviceCardHeader(props: {\n    device: JDDevice\n    showAvatar?: boolean\n    showDeviceId?: boolean\n    showFirmware?: boolean\n    showTemperature?: boolean\n    showMedia?: boolean\n    showSettings?: boolean\n    showReset?: boolean\n}) {\n    const {\n        device,\n        showFirmware,\n        showTemperature,\n        showMedia,\n        showDeviceId,\n        showAvatar,\n        showSettings,\n        showReset,\n    } = props\n    const specification = useDeviceSpecification(device)\n\n    return (\n        <>\n            {showMedia && <DeviceCardMedia device={device} />}\n            <CardHeader\n                avatar={showAvatar && <DeviceAvatar device={device} />}\n                action={\n                    <DeviceActions\n                        device={device}\n                        showReset={showReset}\n                        showSettings={showSettings}\n                        hideIdentity={showAvatar}\n                    />\n                }\n                title={\n                    <Link\n                        color=\"textPrimary\"\n                        underline=\"hover\"\n                        to={`/devices/${\n                            identifierToUrlPath(specification?.id) || \"\"\n                        }`}\n                    >\n                        <DeviceName device={device} />\n                    </Link>\n                }\n                subheader={\n                    <Grid container spacing={1}>\n                        <Grid item>\n                            <Typography variant=\"caption\" gutterBottom>\n                                {[\n                                    specification?.name,\n                                    showDeviceId && device.deviceId,\n                                ]\n                                    .filter(s => !!s)\n                                    .join(\", \")}\n                            </Typography>\n                        </Grid>\n                        {showFirmware && (\n                            <Grid item>\n                                <DeviceFirmwareVersionChip device={device} />\n                            </Grid>\n                        )}\n                        {showTemperature && (\n                            <Grid item>\n                                <DeviceTemperatureChip device={device} />\n                            </Grid>\n                        )}\n                    </Grid>\n                }\n            />\n        </>\n    )\n}\n","import React from \"react\"\nimport {\n    CircularProgressProps,\n    Box,\n    CircularProgress,\n    Typography,\n} from \"@mui/material\"\n\nexport default function CircularProgressWithLabel(\n    props: CircularProgressProps & { value: number }\n) {\n    return (\n        <Box position=\"relative\" display=\"inline-flex\">\n            <CircularProgress variant=\"determinate\" {...props} />\n            <Box\n                top={0}\n                left={0}\n                bottom={0}\n                right={0}\n                position=\"absolute\"\n                display=\"flex\"\n                alignItems=\"center\"\n                justifyContent=\"center\"\n            >\n                <Typography\n                    variant=\"caption\"\n                    component=\"div\"\n                    color=\"textSecondary\"\n                >{`${Math.round(props.value)}%`}</Typography>\n            </Box>\n        </Box>\n    )\n}\n","import { GridSize } from \"@mui/material\"\nimport React, { useContext } from \"react\"\nimport AppContext, { DrawerType } from \"./AppContext\"\n\nexport interface GridBreakpoints {\n    xs?: GridSize\n    md?: GridSize\n    sm?: GridSize\n    lg?: GridSize\n    xl?: GridSize\n}\n\nexport default function useGridBreakpoints(\n    itemCount?: number\n): GridBreakpoints {\n    const { drawerType } = useContext(AppContext)\n    const hasDrawer = drawerType !== DrawerType.None\n\n    if (!drawerType && itemCount !== undefined) {\n        switch (itemCount) {\n            case 1:\n            case 2:\n                return { xs: 12, sm: 6, md: 6, lg: 6, xl: 6 }\n            case 3:\n                return { xs: 12, sm: 6, md: 6, lg: 4, xl: 4 }\n        }\n    }\n\n    if (hasDrawer) return { xs: 12, md: 6, sm: 6, lg: 6, xl: 4 }\n    else\n        return {\n            xs: 12,\n            sm: 6,\n            md: 4,\n            lg: 4,\n            xl: 3,\n        }\n}\n","import React, { useContext } from \"react\"\nimport {\n    Grid,\n    CardContent,\n    Card,\n    CardActions,\n    Switch,\n    Box,\n} from \"@mui/material\"\nimport useChange from \"../jacdac/useChange\"\nimport JacdacContext, { JacdacContextProps } from \"../jacdac/Context\"\nimport useGridBreakpoints from \"./useGridBreakpoints\"\nimport DeviceCardHeader from \"./devices/DeviceCardHeader\"\nimport JDService from \"../../jacdac-ts/src/jdom/service\"\nimport { DeviceLostAlert } from \"./alert/DeviceLostAlert\"\nimport Alert from \"./ui/Alert\"\n\nfunction ServiceListItem(props: {\n    service: JDService\n    content?: JSX.Element | JSX.Element[]\n    checked?: boolean\n    checkedDisabled?: boolean\n    toggleChecked?: () => void\n    actions?: JSX.Element | JSX.Element[]\n}) {\n    const {\n        service,\n        content,\n        checked,\n        checkedDisabled,\n        toggleChecked,\n        actions,\n    } = props\n    const { device } = service\n\n    const handleCheck = () => toggleChecked()\n\n    return (\n        <Card>\n            <DeviceCardHeader device={device} showMedia={true} />\n            <CardContent>\n                <DeviceLostAlert device={device} />\n                {content}\n            </CardContent>\n            <CardActions>\n                {checked !== undefined && (\n                    <Switch\n                        disabled={checkedDisabled}\n                        onChange={handleCheck}\n                        checked={checked}\n                    />\n                )}\n                {actions}\n            </CardActions>\n        </Card>\n    )\n}\n\nexport default function ServiceList(props: {\n    serviceClass: number\n    selected?: (service: JDService) => boolean\n    toggleSelected?: (service: JDService) => void\n    content?: (service: JDService) => JSX.Element | JSX.Element[]\n    actions?: (service: JDService) => JSX.Element | JSX.Element[]\n    alertMissing?: string\n}) {\n    const {\n        serviceClass,\n        selected,\n        toggleSelected,\n        content,\n        actions,\n        alertMissing,\n    } = props\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const services = useChange(bus, n => n.services({ serviceClass }))\n    const gridBreakpoints = useGridBreakpoints(services?.length)\n\n    const handleSelected = (service: JDService) => selected && selected(service)\n    const handleChecked = (service: JDService) => () =>\n        toggleSelected && toggleSelected(service)\n    const serviceContent = (service: JDService) => content && content(service)\n    const serviceActions = (service: JDService) => actions && actions(service)\n\n    if (alertMissing && !services?.length)\n        return <Alert severity=\"info\">{alertMissing}</Alert>\n\n    return (\n        <Box mb={1}>\n            <Grid container spacing={2}>\n                {services?.map(service => (\n                    <Grid key={service.id} item {...gridBreakpoints}>\n                        <ServiceListItem\n                            service={service}\n                            checked={handleSelected(service)}\n                            toggleChecked={handleChecked(service)}\n                            content={serviceContent(service)}\n                            actions={serviceActions(service)}\n                        />\n                    </Grid>\n                ))}\n            </Grid>\n        </Box>\n    )\n}\n","import React, { useContext, useEffect, useState } from \"react\"\nimport {\n    JSONTryParse,\n    readBlobToText,\n    readBlobToUint8Array,\n} from \"../../jacdac-ts/src/jdom/utils\"\nimport DbContext, { DB_VALUE_CHANGE } from \"./DbContext\"\nimport useEffectAsync from \"./useEffectAsync\"\n\nexport function useDbBlob(id: string) {\n    const { db } = useContext(DbContext)\n    const [_value, _setValue] = useState<Blob>(undefined)\n    const values = db?.blobs\n\n    // listen to change\n    useEffect(() => {\n        let _mounted = true\n        return values?.subscribe(DB_VALUE_CHANGE, async changed => {\n            if (changed === id) {\n                try {\n                    const v = await values.get(id)\n                    if (_mounted) {\n                        _setValue(v)\n                    }\n                } catch (e) {\n                    console.log(e)\n                    await values?.set(id, undefined)\n                }\n            }\n            return () => {\n                _mounted = false\n            }\n        })\n    }, [values])\n\n    // load intial value\n    useEffectAsync(\n        async mounted => {\n            try {\n                const v = await values?.get(id)\n                if (mounted()) _setValue(v)\n            } catch (e) {\n                console.log(e)\n                // trash data\n                await values?.set(id, undefined)\n            }\n        },\n        [values]\n    )\n\n    return {\n        blob: _value,\n        setBlob: async (blob: Blob) => {\n            await values?.set(id, blob)\n        },\n    }\n}\n\nexport function useDbUint8Array(blobName: string) {\n    const { blob, setBlob } = useDbBlob(blobName)\n    const [model, setModel] = useState<Uint8Array>(undefined)\n\n    useEffectAsync(\n        async mounted => {\n            if (!blob) {\n                setModel(undefined)\n            } else {\n                const buf = await readBlobToUint8Array(blob)\n                if (mounted()) setModel(buf)\n            }\n        },\n        [blob]\n    )\n\n    return {\n        data: model,\n        setBlob,\n    }\n}\n\nexport function useDbString(blobName: string) {\n    const { blob, setBlob } = useDbBlob(blobName)\n    const [model, setModel] = useState<string>(undefined)\n\n    useEffectAsync(async () => {\n        if (!blob) {\n            setModel(undefined)\n        } else {\n            const t = await readBlobToText(blob)\n            setModel(t)\n        }\n    }, [blob])\n\n    return {\n        data: model,\n        setBlob,\n    }\n}\n\nexport function useDbJSON<T>(blobName: string) {\n    const { data, setBlob } = useDbString(blobName)\n    const value: T = JSONTryParse<T>(data)\n    return {\n        value,\n        setBlob: async (blob: Blob) => {\n            await setBlob(blob)\n        },\n    }\n}\n","import Packet from \"../jdom/packet\"\nimport { REPORT_RECEIVE, SRV_MODEL_RUNNER } from \"../jdom/constants\"\nimport JDService from \"../jdom/service\"\nimport { ModelRunnerCmd, ModelRunnerReg } from \"../jdom/constants\"\nimport { bufferToArray, NumberFormat } from \"../jdom/buffer\"\nimport { OutPipe } from \"../jdom/pipes\"\nimport JDRegister from \"../jdom/register\"\nimport { JDServiceClient } from \"../jdom/serviceclient\"\nimport { serviceSpecificationFromClassIdentifier } from \"../jdom/spec\"\nimport { jdunpack } from \"../jdom/pack\"\nimport { assert, read32, toHex, uint8ArrayToString } from \"../jdom/utils\"\n\n/*\n    enum SampleType : u8 {\n        U8 = 0x08\n        I8 = 0x88\n        U16 = 0x10\n        I16 = 0x90\n        U32 = 0x20\n        I32 = 0xA0\n    }\n    rw inputs @ 0x80 {\n        sampling_interval: u16 ms\n        samples_in_window: u16\n        reserved: u32\n    repeats:\n        device_id: devid\n        service_class: u32\n        service_num: u8\n        sample_size: u8 B\n        sample_type: SampleType\n        sample_shift: i8\n    }\n*/\n\nexport function isMLModelSupported(model: Uint8Array, formatRegValue: number) {\n    return (\n        read32(model, 0) == formatRegValue || read32(model, 4) == formatRegValue\n    )\n}\n\nexport function getMLModelFormatName(model: Uint8Array) {\n    const map =\n        serviceSpecificationFromClassIdentifier(SRV_MODEL_RUNNER).enums[\n            \"ModelFormat\"\n        ].members\n    const m0 = read32(model, 0)\n    const m1 = read32(model, 4)\n    for (const v of Object.keys(map)) {\n        if (map[v] == m0 || map[v] == m1) return v\n    }\n    return \"0x\" + toHex(model.slice(0, 8))\n}\n\n/**\n * A client for the model runner service\n * @category Clients\n */\nexport class ModelRunnerClient extends JDServiceClient {\n    constructor(service: JDService) {\n        super(service)\n        assert(service.serviceClass == SRV_MODEL_RUNNER)\n        this.service.registersUseAcks = true\n    }\n\n    // TODO this should use some caching?\n    async isModelSupported(model: Uint8Array) {\n        const reg = this.service.register(ModelRunnerReg.Format)\n        await reg.refresh()\n        return reg.data == null || isMLModelSupported(model, reg.intValue >>> 0)\n    }\n\n    subscribeResults(handler: (sample: number[]) => void): () => void {\n        const reg = this.service.register(ModelRunnerReg.Outputs)\n        return reg.subscribe(REPORT_RECEIVE, () => {\n            handler(bufferToArray(reg.data, NumberFormat.Float32LE))\n        })\n    }\n\n    async deployModel(model: Uint8Array, onProgress?: (p: number) => void) {\n        onProgress?.(0)\n        const resp = await this.service.sendCmdAwaitResponseAsync(\n            Packet.jdpacked(ModelRunnerCmd.SetModel, \"u32\", [model.length]),\n            3000\n        )\n        onProgress?.(0.05)\n        const [pipePort] = jdunpack<[number]>(resp.data, \"u16\")\n        if (!pipePort) throw new Error(\"wrong port \" + pipePort)\n        const pipe = new OutPipe(this.service.device, pipePort)\n        const chunkSize = 224 // has to be divisible by 8\n        for (let i = 0; i < model.length; i += chunkSize) {\n            await pipe.send(model.slice(i, i + chunkSize))\n            onProgress?.(0.05 + (i / model.length) * 0.9)\n        }\n        try {\n            await pipe.close()\n        } catch {\n            // the device may restart before we manage to close\n        }\n        onProgress?.(1)\n    }\n\n    async autoInvoke(everySamples = 1) {\n        await this.service\n            .register(ModelRunnerReg.AutoInvokeEvery)\n            .sendSetPackedAsync([everySamples])\n    }\n\n    private async getReg(id: ModelRunnerReg, f: (v: JDRegister) => any) {\n        const reg = this.service.register(id)\n        await reg.refresh()\n        return f(reg)\n    }\n\n    async modelStats(): Promise<TFModelStats> {\n        const info: any = {\n            modelSize: this.getReg(ModelRunnerReg.ModelSize, r => r.intValue),\n            arenaSize: this.getReg(\n                ModelRunnerReg.AllocatedArenaSize,\n                r => r.intValue\n            ),\n            inputShape: this.getReg(ModelRunnerReg.InputShape, r =>\n                bufferToArray(r.data, NumberFormat.UInt16LE)\n            ),\n            outputShape: this.getReg(ModelRunnerReg.OutputShape, r =>\n                bufferToArray(r.data, NumberFormat.UInt16LE)\n            ),\n            lastError: this.getReg(ModelRunnerReg.LastError, r =>\n                uint8ArrayToString(r.data)\n            ),\n        }\n        for (const id of Object.keys(info)) {\n            info[id] = await info[id]\n        }\n        return info\n    }\n}\nexport default ModelRunnerClient\n\nexport interface TFModelStats {\n    modelSize: number\n    arenaSize: number\n    inputShape: number[]\n    outputShape: number[]\n    lastError: string\n}\n\n/*\nexport async function testAGG(bus: JDBus) {\n    const aggService = bus.services({ serviceClass: SRV_SENSOR_AGGREGATOR })[0]\n    if (!aggService) {\n        console.log(\"no agg service\")\n        return\n    }\n    const agg = new SensorAggregatorClient(aggService)\n\n    let acc = bus.services({ serviceClass: SRV_ACCELEROMETER })\n    if (acc.length == 0) {\n        console.log(\"no acc service\")\n        return\n    }\n\n    await agg.setInputs({\n        samplesInWindow: 50,\n        samplingInterval: 20,\n        inputs: acc\n    })\n\n    agg.subscribeSample(sample => {\n        console.log(\"SAMPLE\", sample)\n    })\n\n}\n\nexport async function testTF(bus: JDBus, model: Uint8Array) {\n    const tfService = bus.services({ serviceClass: SRV_MODEL_RUNNER })[0]\n    if (!tfService) {\n        console.log(\"no tflite service\")\n        return\n    }\n    const tf = new TFLiteClient(tfService)\n\n    if (model)\n        await tf.deployModel(model, p => console.log(\"deploy\", p.toFixed(3)))\n\n    const st = await tf.modelStats()\n    console.log(st)\n\n    const classNames = ['noise', 'punch', 'left', 'right'];\n    tf.subscribeResults(outp => {\n        for (let i = 0; i < outp.length; ++i) {\n            if (outp[i] > 0.7) {\n                console.log(outp[i].toFixed(3) + \" \" + classNames[i])\n            }\n        }\n         console.log(\"OUT\", outp)\n    })\n\n    await tf.autoInvoke(8)\n\n    console.log(\"autoinvoked\")\n\n}\n*/\n","import { Paper } from \"@mui/material\"\nimport React, { useContext } from \"react\"\nimport { serviceName } from \"../../jacdac-ts/src/jdom/pretty\"\nimport {\n    SensorAggregatorConfig,\n    SensorAggregatorInputConfig,\n} from \"../../jacdac-ts/src/clients/sensoraggregatorclient\"\nimport JacdacContext, { JacdacContextProps } from \"../jacdac/Context\"\nimport DeviceName from \"./devices/DeviceName\"\n\nfunction SensorAggregatorInputConfigView(props: {\n    input: SensorAggregatorInputConfig\n}) {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { input } = props\n    const { serviceClass, deviceId, serviceIndex } = input\n\n    const device = deviceId && bus.device(deviceId)\n\n    return (\n        <>\n            {serviceName(serviceClass)}\n            {device && (\n                <DeviceName device={device} serviceIndex={serviceIndex} />\n            )}\n            {!device && deviceId && (\n                <span>\n                    {deviceId}[{serviceIndex}]\n                </span>\n            )}\n            {!deviceId && <span>/ any device</span>}\n        </>\n    )\n}\n\nexport default function SensorAggregatorConfigView(props: {\n    config: SensorAggregatorConfig\n}) {\n    const { config } = props\n\n    if (!config?.inputs) return <></>\n\n    return (\n        <Paper>\n            <ul>\n                <li>\n                    samples interval (ms):{\" \"}\n                    <code>{config.samplingInterval}</code>\n                </li>\n                <li>\n                    samples window (# samples):{\" \"}\n                    <code>{config.samplesInWindow}</code>\n                </li>\n                <li>\n                    inputs ({config.inputs.length})\n                    <ul>\n                        {config.inputs.map((input, i) => (\n                            <li key={\"input\" + i}>\n                                <SensorAggregatorInputConfigView\n                                    input={input}\n                                />\n                            </li>\n                        ))}\n                    </ul>\n                </li>\n            </ul>\n        </Paper>\n    )\n}\n","import React, { useContext, useState } from \"react\"\nimport Alert from \"./ui/Alert\"\nimport AppContext from \"./AppContext\"\n\nexport type ProgressHandler = (p: number) => void\n\nexport default function useCall() {\n    const { setError: setAppError } = useContext(AppContext)\n    const [error, setError] = useState<Error>()\n    const [running, setRunning] = useState(false)\n    const [progress, setProgress] = useState(0)\n\n    const handleProgress = (p: number) => setProgress(p)\n\n    const call = (handler: (onProgress?: ProgressHandler) => void) => {\n        try {\n            setRunning(true)\n            setError(undefined)\n            handler(handleProgress)\n        } catch (e) {\n            setError(e)\n            setAppError(e)\n        } finally {\n            setRunning(false)\n        }\n    }\n    const callAsync = async (\n        handler: (onProgress?: (p: number) => void) => Promise<void>\n    ) => {\n        try {\n            setRunning(true)\n            setError(undefined)\n            await handler(handleProgress)\n        } catch (e) {\n            setError(e)\n            setAppError(e)\n        } finally {\n            setRunning(false)\n        }\n    }\n    const alert = error && <Alert severity=\"error\">{error}</Alert>\n\n    return {\n        running,\n        error,\n        progress,\n        alert,\n        call,\n        callAsync,\n    }\n}\n","import createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"\n}), 'Link');","import { List, ListItem, ListItemText, Typography } from \"@mui/material\"\nimport React, { lazy, useContext, useState } from \"react\"\nimport {\n    SRV_SENSOR_AGGREGATOR,\n    SRV_MODEL_RUNNER,\n    ModelRunnerReg,\n} from \"../../../jacdac-ts/src/jdom/constants\"\nimport JDService from \"../../../jacdac-ts/src/jdom/service\"\nimport ServiceList from \"../../components/ServiceList\"\nimport ConnectAlert from \"../../components/alert/ConnectAlert\"\nimport { useDbJSON, useDbUint8Array } from \"../../components/useDb\"\nimport Alert from \"../../components/ui/Alert\"\nimport { Button } from \"gatsby-theme-material-ui\"\nimport ModelRunnerClient from \"../../../jacdac-ts/src/clients/modelrunnerclient\"\nimport RegisterInput from \"../../components/RegisterInput\"\nimport CircularProgressWithLabel from \"../../components/ui/CircularProgressWithLabel\"\nimport SensorAggregatorClient, {\n    SensorAggregatorConfig,\n} from \"../../../jacdac-ts/src/clients/sensoraggregatorclient\"\nimport SensorAggregatorConfigView from \"../../components/SensorAggregatorConfigView\"\nimport ServiceManagerContext from \"../../components/ServiceManagerContext\"\nimport useChange from \"../../jacdac/useChange\"\nimport { IFile } from \"../../../jacdac-ts/src/embed/protocol\"\nimport { prettySize } from \"../../../jacdac-ts/src/jdom/pretty\"\nimport RegisterTrend from \"../../components/RegisterTrend\"\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\"\nimport useCall from \"../../components/useCall\"\n\nimport Suspense from \"../../components/ui/Suspense\"\nimport { Link } from \"@mui/icons-material\"\nimport useRegister from \"../../components/hooks/useRegister\"\nconst ImportButton = lazy(() => import(\"../../components/ImportButton\"))\n\nexport function ModelContent(props: { service: JDService }) {\n    const { service } = props\n\n    const modelSizeRegister = useRegister(service, ModelRunnerReg.ModelSize)\n    const lastErrorRegister = useRegister(service, ModelRunnerReg.LastError)\n    const autoInvokeEveryRegister = useRegister(\n        service,\n        ModelRunnerReg.AutoInvokeEvery\n    )\n    const outputsRegister = useRegister(service, ModelRunnerReg.Outputs)\n\n    const [modelSize] = useRegisterUnpackedValue<[number]>(modelSizeRegister)\n    const [lastError] = useRegisterUnpackedValue<[number]>(lastErrorRegister)\n\n    return (\n        <>\n            {lastError && <Alert severity=\"warning\">{lastError}</Alert>}\n            <Typography>\n                model size:{\" \"}\n                {modelSize === undefined ? \"...\" : prettySize(modelSize)}\n            </Typography>\n            <RegisterInput register={autoInvokeEveryRegister} visible={true} />\n            <RegisterTrend showName register={outputsRegister} mini={true} />\n        </>\n    )\n}\n\nexport function ModelActions(props: {\n    service: JDService\n    model: Uint8Array\n    sensorAggregatorService?: JDService\n    sensorInput?: SensorAggregatorConfig\n}) {\n    const { service, model, sensorAggregatorService, sensorInput } = props\n    const { running, progress, alert, callAsync } = useCall()\n\n    const modelDisabled = !service || !model || running\n\n    const handleDeployModel = async () =>\n        await callAsync(async setProgress => {\n            if (sensorAggregatorService && sensorInput) {\n                const aggregator = new SensorAggregatorClient(\n                    sensorAggregatorService\n                )\n                await aggregator.setInputs(sensorInput)\n            }\n            if (service && model) {\n                const runner = new ModelRunnerClient(service)\n                await runner.deployModel(model, setProgress)\n            }\n        })\n\n    return (\n        <>\n            {!running && (\n                <Button\n                    disabled={modelDisabled}\n                    variant=\"contained\"\n                    color=\"primary\"\n                    onClick={handleDeployModel}\n                >\n                    {sensorInput\n                        ? \"Deploy model and configuration\"\n                        : \"Deploy model\"}\n                </Button>\n            )}\n            {running && <CircularProgressWithLabel value={progress * 100} />}\n            {alert}\n        </>\n    )\n}\n\nexport default function ModelUploader() {\n    const [importing, setImporting] = useState(false)\n    const { data: model, setBlob: setModel } = useDbUint8Array(\"model.tflite\")\n    const { value: sensorConfig, setBlob: setSensorConfig } =\n        useDbJSON<SensorAggregatorConfig>(\"sensor-input.json\")\n    const { modelStore } = useContext(ServiceManagerContext)\n\n    const handleTfmodelFiles = async (files: File[]) => {\n        const file = files[0]\n        if (file) {\n            try {\n                setImporting(true)\n                await setModel(file)\n            } finally {\n                setImporting(false)\n            }\n        }\n    }\n    const handleClearModel = async () => {\n        try {\n            setImporting(true)\n            await setModel(undefined)\n        } finally {\n            setImporting(false)\n        }\n    }\n    const handleSensorConfigFiles = async (files: File[]) => {\n        const file = files[0]\n        if (file) {\n            try {\n                setImporting(true)\n                await setSensorConfig(file)\n            } finally {\n                setImporting(false)\n            }\n        }\n    }\n    const handleClearConfiguration = async () => {\n        try {\n            setImporting(true)\n            await setSensorConfig(undefined)\n        } finally {\n            setImporting(false)\n        }\n    }\n    const handleLoadModel = (model: IFile) => async () => {\n        try {\n            setImporting(true)\n            console.log(`loading model`, model)\n            const blob = await modelStore.loadFile(model)\n            console.log(`loaded content`, blob)\n            if (blob) {\n                setModel(blob)\n            }\n        } finally {\n            setImporting(false)\n        }\n    }\n    const handleLoadInputConfiguration = (model: IFile) => async () => {\n        try {\n            setImporting(true)\n            console.log(`loading model`, model)\n            const blob = await modelStore.loadFile(model)\n            console.log(`loaded content`, blob)\n            if (blob) {\n                setSensorConfig(blob)\n            }\n        } finally {\n            setImporting(false)\n        }\n    }\n\n    const models = useChange(modelStore, _ => _?.models())\n    const inputConfigurations = useChange(modelStore, _ =>\n        _?.inputConfigurations()\n    )\n\n    return (\n        <>\n            <h1>Model uploader</h1>\n            <p>\n                Upload Machine Learning Models (like TensorFlow Lite) into your{\" \"}\n                <Link to=\"/services/model-runner/\">ML module runners</Link>.\n            </p>\n            <h3>Load a machine learning model</h3>\n            <p>\n                Machine learning models are typically stored in a{\" \"}\n                <code>.tflite</code> file.\n            </p>\n            {model && (\n                <Alert severity={\"success\"}>\n                    Model loaded ({prettySize(model.byteLength)})\n                </Alert>\n            )}\n            {model && <p />}\n            <Suspense>\n                <ImportButton\n                    disabled={importing}\n                    text={\"Import model\"}\n                    onFilesUploaded={handleTfmodelFiles}\n                />\n            </Suspense>\n            <Button\n                aria-label=\"clear model\"\n                disabled={importing}\n                onClick={handleClearModel}\n            >\n                clear model\n            </Button>\n            {models?.length && (\n                <List>\n                    {models.map(model => (\n                        <ListItem\n                            key={model.path}\n                            button\n                            onClick={handleLoadModel(model)}\n                        >\n                            <ListItemText\n                                primary={model.name}\n                                secondary={`${model.path} ${prettySize(\n                                    model.size\n                                )}`}\n                            />\n                        </ListItem>\n                    ))}\n                </List>\n            )}\n            <h3>Configure sensors</h3>\n            <p>\n                Sensor configuration files are stored in a <code>.jd.json</code>{\" \"}\n                file.\n            </p>\n            {sensorConfig && (\n                <Alert severity={\"success\"}>Sensor configuration loaded</Alert>\n            )}\n            {sensorConfig && (\n                <SensorAggregatorConfigView config={sensorConfig} />\n            )}\n            {sensorConfig && <p />}\n            <Suspense>\n                <ImportButton\n                    disabled={importing}\n                    text={\"Import configuration\"}\n                    onFilesUploaded={handleSensorConfigFiles}\n                />\n            </Suspense>\n            <Button\n                aria-label=\"clear configuration\"\n                disabled={importing}\n                onClick={handleClearConfiguration}\n            >\n                clear configuration\n            </Button>\n            {inputConfigurations?.length && (\n                <List>\n                    {inputConfigurations.map(iconfig => (\n                        <ListItem\n                            key={iconfig.path}\n                            button\n                            onClick={handleLoadInputConfiguration(iconfig)}\n                        >\n                            <ListItemText\n                                primary={iconfig.name}\n                                secondary={`${iconfig.path} ${prettySize(\n                                    iconfig.size\n                                )}`}\n                            />\n                        </ListItem>\n                    ))}\n                </List>\n            )}\n            <h3>Deploy model to machine learning services</h3>\n            <ConnectAlert serviceClass={SRV_MODEL_RUNNER} />\n            <ServiceList\n                serviceClass={SRV_MODEL_RUNNER}\n                content={service => <ModelContent service={service} />}\n                actions={service => (\n                    <ModelActions\n                        service={service}\n                        model={model}\n                        sensorAggregatorService={\n                            service?.device.services({\n                                serviceClass: SRV_SENSOR_AGGREGATOR,\n                            })?.[0]\n                        }\n                        sensorInput={sensorConfig}\n                    />\n                )}\n            />\n        </>\n    )\n}\n"],"names":["SensorAggregatorReg","SensorAggregatorSampleType","SRV_SENSOR_AGGREGATOR","bufferToArray","NumberFormat","JD_SERIAL_MAX_PAYLOAD_SIZE","REPORT_RECEIVE","jdpack","JDServiceClient","isReading","serviceSpecificationFromClassIdentifier","assert","bufferConcat","bufferConcatMany","fromHex","SensorAggregatorClient","service","serviceClass","registersUseAcks","setInputs","cfg","error","msg","Error","mapType","tp","U8","U16","U32","I8","I16","I32","inputs","totalSampleSize","map","input","deviceId","serviceIndex","specification","toString","freeze","readingReg","packets","find","sampleType","undefined","sampleSize","sampleShift","field","fields","Math","abs","storage","shift","Uint8Array","unshift","samplingInterval","samplesInWindow","register","Inputs","sendSetAsync","collect","numSamples","StreamingSamples","sendSetPackedAsync","subscribeSample","handler","reg","CurrentSample","mount","subscribe","data","Float32LE","getReg","id","f","refresh","stats","info","NumSamples","r","intValue","SampleSize","Object","keys","Box","Alert","React","useContext","JacdacContext","NoSsr","ConnectButtons","useDevices","NoSsrConnectAlert","props","closeable","bus","transports","devices","ignoreInfrastructure","spec","length","name","ConnectAlert","useDeviceSpecification","useDeviceImage","CardMediaWithSkeleton","DeviceCardMedia","device","imageUrl","ControlReg","JD_SERVICE_INDEX_CTRL","CardHeader","Chip","Grid","Typography","Link","useRegisterUnpackedValue","DeviceActions","DeviceName","identifierToUrlPath","DeviceAvatar","useChange","useRegister","DeviceFirmwareVersionChip","control","_","productIdentifierRegister","ProductIdentifier","productIdentifier","firmwareVersionRegister","FirmwareVersion","firmwareVersion","firmwareName","firmwares","fw","filter","join","DeviceTemperatureChip","tempRegister","McuTemperature","temperature","isNaN","DeviceCardHeader","showFirmware","showTemperature","showMedia","showDeviceId","showAvatar","showSettings","showReset","s","CircularProgress","CircularProgressWithLabel","round","value","AppContext","DrawerType","useGridBreakpoints","itemCount","drawerType","hasDrawer","None","xs","sm","md","lg","xl","CardContent","Card","CardActions","Switch","DeviceLostAlert","ServiceListItem","content","checked","checkedDisabled","toggleChecked","actions","handleCheck","ServiceList","selected","toggleSelected","alertMissing","services","n","gridBreakpoints","handleSelected","handleChecked","serviceContent","serviceActions","useEffect","useState","JSONTryParse","readBlobToText","readBlobToUint8Array","DbContext","DB_VALUE_CHANGE","useEffectAsync","useDbBlob","db","_value","_setValue","values","blobs","_mounted","changed","v","get","e","console","log","set","mounted","blob","setBlob","useDbUint8Array","blobName","model","setModel","buf","useDbString","t","useDbJSON","Packet","SRV_MODEL_RUNNER","ModelRunnerCmd","ModelRunnerReg","OutPipe","jdunpack","read32","toHex","uint8ArrayToString","isMLModelSupported","formatRegValue","getMLModelFormatName","enums","members","m0","m1","slice","ModelRunnerClient","isModelSupported","Format","subscribeResults","Outputs","deployModel","onProgress","resp","sendCmdAwaitResponseAsync","jdpacked","SetModel","pipePort","pipe","chunkSize","i","send","close","autoInvoke","everySamples","AutoInvokeEvery","modelStats","modelSize","ModelSize","arenaSize","AllocatedArenaSize","inputShape","InputShape","UInt16LE","outputShape","OutputShape","lastError","LastError","Paper","serviceName","SensorAggregatorInputConfigView","SensorAggregatorConfigView","config","useCall","setError","setAppError","running","setRunning","progress","setProgress","handleProgress","p","call","callAsync","alert","List","ListItem","ListItemText","lazy","Button","RegisterInput","ServiceManagerContext","prettySize","RegisterTrend","Suspense","ImportButton","ModelContent","modelSizeRegister","lastErrorRegister","autoInvokeEveryRegister","outputsRegister","ModelActions","sensorAggregatorService","sensorInput","modelDisabled","handleDeployModel","aggregator","runner","ModelUploader","importing","setImporting","sensorConfig","setSensorConfig","modelStore","handleTfmodelFiles","files","file","handleClearModel","handleSensorConfigFiles","handleClearConfiguration","handleLoadModel","loadFile","handleLoadInputConfiguration","models","inputConfigurations","byteLength","path","size","iconfig"],"sourceRoot":""}