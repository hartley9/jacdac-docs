{"version":3,"file":"a77c613bd0faa103b953c0d40475a17f2d569635-9e94ead909bc1bcfde66.js","mappings":"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","sources":["webpack://jacdac-docs/./jacdac-ts/src/clients/sensoraggregatorclient.ts","webpack://jacdac-docs/./src/components/ServiceList.tsx","webpack://jacdac-docs/./src/components/alert/ConnectAlert.tsx","webpack://jacdac-docs/./src/components/ui/CircularProgressWithLabel.tsx","webpack://jacdac-docs/./src/components/useGridBreakpoints.ts","webpack://jacdac-docs/./src/components/useDb.ts","webpack://jacdac-docs/./jacdac-ts/src/clients/modelrunnerclient.ts","webpack://jacdac-docs/./src/components/SensorAggregatorConfigView.tsx","webpack://jacdac-docs/./src/components/useCall.tsx","webpack://jacdac-docs/./node_modules/@material-ui/icons/esm/Link.js","webpack://jacdac-docs/./src/pages/tools/model-uploader.tsx"],"sourcesContent":["import {\n    SensorAggregatorReg,\n    SensorAggregatorSampleType,\n    SRV_SENSOR_AGGREGATOR,\n} from \"../../jacdac-spec/dist/specconstants\"\nimport { bufferToArray, NumberFormat } from \"../jdom/buffer\"\nimport { JD_SERIAL_MAX_PAYLOAD_SIZE, REPORT_RECEIVE } from \"../jdom/constants\"\nimport { jdpack } from \"../jdom/pack\"\nimport JDRegister from \"../jdom/register\"\nimport JDService from \"../jdom/service\"\nimport { JDServiceClient } from \"../jdom/serviceclient\"\nimport {\n    isReading,\n    serviceSpecificationFromClassIdentifier,\n} from \"../jdom/spec\"\nimport { assert, bufferConcat, bufferConcatMany, fromHex } from \"../jdom/utils\"\n\nexport interface SensorAggregatorInputConfig {\n    serviceClass: number\n    // if specified, also specify serviceIndex\n    deviceId?: string\n    serviceIndex?: number\n}\n\nexport interface SensorAggregatorConfig {\n    samplingInterval: number // ms\n    samplesInWindow: number\n    inputs: SensorAggregatorInputConfig[]\n}\n\nexport interface SensorAggregatorStats {\n    numSamples: number\n    sampleSize: number\n}\n\n/**\n * A client for the sensor aggregator service\n * @category Clients\n */\nexport class SensorAggregatorClient extends JDServiceClient {\n    constructor(service: JDService) {\n        super(service)\n        assert(service.serviceClass === SRV_SENSOR_AGGREGATOR)\n        this.service.registersUseAcks = true\n    }\n\n    async setInputs(cfg: SensorAggregatorConfig) {\n        function error(msg: string) {\n            throw new Error(\"Aggregator inputs: \" + msg)\n        }\n        function mapType(tp: number) {\n            switch (tp) {\n                case 1:\n                    return SensorAggregatorSampleType.U8\n                case 2:\n                    return SensorAggregatorSampleType.U16\n                case 4:\n                    return SensorAggregatorSampleType.U32\n                case -1:\n                    return SensorAggregatorSampleType.I8\n                case -2:\n                    return SensorAggregatorSampleType.I16\n                case -4:\n                    return SensorAggregatorSampleType.I32\n                default:\n                    error(\"unknown storage type\")\n            }\n        }\n\n        if (!cfg || !cfg.inputs) error(\"invalid input format\")\n\n        let totalSampleSize = 0\n        const inputs = cfg.inputs?.map(input => {\n            const { deviceId, serviceIndex, serviceClass } = input\n            if (!!deviceId !== !!serviceIndex)\n                error(`deviceId and serviceIndex must be specified together`)\n            const specification =\n                serviceSpecificationFromClassIdentifier(serviceClass)\n            if (!specification)\n                error(\n                    `missing specification from service 0x${serviceClass.toString(\n                        16\n                    )}`\n                )\n            const freeze = !!deviceId\n            const readingReg = specification.packets.find(isReading)\n            if (!readingReg)\n                error(\n                    `service 0x${serviceClass.toString(\n                        16\n                    )} does not have a reading register`\n                )\n            let sampleType: SensorAggregatorSampleType = undefined\n            let sampleSize = 0\n            let sampleShift = 0\n            for (const field of readingReg.fields) {\n                sampleSize += Math.abs(field.storage)\n                if (sampleType === undefined) {\n                    sampleType = mapType(field.storage)\n                    sampleShift = field.shift || 0\n                }\n                if (\n                    sampleType != mapType(field.storage) ||\n                    sampleShift != (field.shift || 0)\n                )\n                    error(\"heterogenous field types\")\n            }\n            totalSampleSize += sampleSize\n            return bufferConcat(\n                freeze ? fromHex(deviceId) : new Uint8Array(8),\n                jdpack(\"u32 u8 u8 u8 i8\", [\n                    serviceClass,\n                    freeze ? serviceIndex : 0,\n                    sampleSize,\n                    sampleType,\n                    sampleShift,\n                ])\n            )\n        })\n\n        if (totalSampleSize > JD_SERIAL_MAX_PAYLOAD_SIZE)\n            error(\"samples won't fit in packet\")\n\n        // u32 is x[4]\n        inputs.unshift(\n            jdpack(\"u16 u16 u32\", [\n                cfg.samplingInterval,\n                cfg.samplesInWindow,\n                0,\n            ])\n        )\n        await this.service\n            .register(SensorAggregatorReg.Inputs)\n            .sendSetAsync(bufferConcatMany(inputs))\n    }\n\n    async collect(numSamples: number) {\n        await this.service\n            .register(SensorAggregatorReg.StreamingSamples)\n            .sendSetPackedAsync([numSamples])\n    }\n\n    subscribeSample(handler: (sample: number[]) => void): () => void {\n        const reg = this.service.register(SensorAggregatorReg.CurrentSample)\n        return this.mount(\n            reg.subscribe(REPORT_RECEIVE, () =>\n                handler(bufferToArray(reg.data, NumberFormat.Float32LE))\n            )\n        )\n    }\n\n    private async getReg(id: SensorAggregatorReg, f: (v: JDRegister) => any) {\n        const reg = this.service.register(id)\n        await reg.refresh()\n        return f(reg)\n    }\n\n    async stats(): Promise<SensorAggregatorStats> {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const info: any = {\n            numSamples: this.getReg(\n                SensorAggregatorReg.NumSamples,\n                r => r.intValue\n            ),\n            sampleSize: this.getReg(\n                SensorAggregatorReg.SampleSize,\n                r => r.intValue\n            ),\n        }\n        for (const id of Object.keys(info)) {\n            info[id] = await info[id]\n        }\n        return info\n    }\n}\nexport default SensorAggregatorClient\n","import React, { useContext } from \"react\"\nimport {\n    Grid,\n    CardContent,\n    Card,\n    CardActions,\n    Switch,\n    Box,\n} from \"@material-ui/core\"\nimport useChange from \"../jacdac/useChange\"\nimport JacdacContext, { JacdacContextProps } from \"../jacdac/Context\"\nimport useGridBreakpoints from \"./useGridBreakpoints\"\nimport DeviceCardHeader from \"./DeviceCardHeader\"\nimport JDService from \"../../jacdac-ts/src/jdom/service\"\nimport { DeviceLostAlert } from \"./alert/DeviceLostAlert\"\nimport Alert from \"./ui/Alert\"\n\nfunction ServiceListItem(props: {\n    service: JDService\n    content?: JSX.Element | JSX.Element[]\n    checked?: boolean\n    checkedDisabled?: boolean\n    toggleChecked?: () => void\n    actions?: JSX.Element | JSX.Element[]\n}) {\n    const {\n        service,\n        content,\n        checked,\n        checkedDisabled,\n        toggleChecked,\n        actions,\n    } = props\n    const { device } = service\n\n    const handleCheck = () => toggleChecked()\n\n    return (\n        <Card>\n            <DeviceCardHeader device={device} showMedia={true} />\n            <CardContent>\n                <DeviceLostAlert device={device} />\n                {content}\n            </CardContent>\n            <CardActions>\n                {checked !== undefined && (\n                    <Switch\n                        disabled={checkedDisabled}\n                        onChange={handleCheck}\n                        checked={checked}\n                    />\n                )}\n                {actions}\n            </CardActions>\n        </Card>\n    )\n}\n\nexport default function ServiceList(props: {\n    serviceClass: number\n    selected?: (service: JDService) => boolean\n    toggleSelected?: (service: JDService) => void\n    content?: (service: JDService) => JSX.Element | JSX.Element[]\n    actions?: (service: JDService) => JSX.Element | JSX.Element[]\n    alertMissing?: string\n}) {\n    const {\n        serviceClass,\n        selected,\n        toggleSelected,\n        content,\n        actions,\n        alertMissing,\n    } = props\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const services = useChange(bus, n => n.services({ serviceClass }))\n    const gridBreakpoints = useGridBreakpoints(services?.length)\n\n    const handleSelected = (service: JDService) => selected && selected(service)\n    const handleChecked = (service: JDService) => () =>\n        toggleSelected && toggleSelected(service)\n    const serviceContent = (service: JDService) => content && content(service)\n    const serviceActions = (service: JDService) => actions && actions(service)\n\n    if (alertMissing && !services?.length)\n        return <Alert severity=\"info\">{alertMissing}</Alert>\n\n    return (\n        <Box mb={1}>\n            <Grid container spacing={2}>\n                {services?.map(service => (\n                    <Grid key={service.id} item {...gridBreakpoints}>\n                        <ServiceListItem\n                            service={service}\n                            checked={handleSelected(service)}\n                            toggleChecked={handleChecked(service)}\n                            content={serviceContent(service)}\n                            actions={serviceActions(service)}\n                        />\n                    </Grid>\n                ))}\n            </Grid>\n        </Box>\n    )\n}\n","// tslint:disable-next-line: no-submodule-imports\nimport { Box } from \"@material-ui/core\"\n// tslint:disable-next-line: no-submodule-imports\nimport Alert from \"../ui/Alert\"\nimport React, { useContext } from \"react\"\nimport { serviceSpecificationFromClassIdentifier } from \"../../../jacdac-ts/src/jdom/spec\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport { NoSsr } from \"@material-ui/core\"\nimport useChange from \"../../jacdac/useChange\"\nimport ConnectButtons from \"../buttons/ConnectButtons\"\n\nfunction NoSsrConnectAlert(props: {\n    serviceClass?: number\n    closeable?: boolean\n}) {\n    const { serviceClass, closeable } = props\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { transports } = bus\n    const devices = useChange(bus, b =>\n        b.devices({ serviceClass, ignoreSelf: true })\n    )\n    const spec = serviceSpecificationFromClassIdentifier(serviceClass)\n\n    // don't show if no transport, some devices\n    if (!transports.length || devices?.length) return null\n\n    return (\n        <Box displayPrint=\"none\">\n            <Alert severity=\"info\" closeable={closeable}>\n                {!spec && <span>Did you connect your device?</span>}\n                {spec && <span>Did you connect a {spec.name} device?</span>}\n                <Box component=\"span\" ml={2}>\n                    <ConnectButtons full={true} transparent={true} />\n                </Box>\n            </Alert>\n        </Box>\n    )\n}\n\nexport default function ConnectAlert(props: {\n    serviceClass?: number\n    closeable?: boolean\n}) {\n    return (\n        <NoSsr>\n            <NoSsrConnectAlert {...props} />\n        </NoSsr>\n    )\n}\n","import React from \"react\"\nimport { CircularProgressProps, Box, CircularProgress, Typography } from \"@material-ui/core\";\n\nexport default function CircularProgressWithLabel(props: CircularProgressProps & { value: number }) {\n    return (\n        <Box position=\"relative\" display=\"inline-flex\">\n            <CircularProgress variant=\"determinate\" {...props} />\n            <Box\n                top={0}\n                left={0}\n                bottom={0}\n                right={0}\n                position=\"absolute\"\n                display=\"flex\"\n                alignItems=\"center\"\n                justifyContent=\"center\"\n            >\n                <Typography variant=\"caption\" component=\"div\" color=\"textSecondary\">{`${Math.round(\n                    props.value,\n                )}%`}</Typography>\n            </Box>\n        </Box>\n    );\n}","import { GridSize } from \"@material-ui/core\"\nimport React, { useContext } from \"react\"\nimport AppContext, { DrawerType } from \"./AppContext\"\n\nexport interface GridBreakpoints {\n    xs?: GridSize,\n    md?: GridSize,\n    sm?: GridSize,\n    lg?: GridSize,\n    xl?: GridSize\n}\n\nexport default function useGridBreakpoints(itemCount?: number): GridBreakpoints {\n    const { drawerType } = useContext(AppContext)\n\n    if (itemCount !== undefined) {\n        switch (itemCount) {\n            case 1:\n            case 2: return { xs: 12, sm: 6, md: 6, lg: 6, xl: 6 }\n            case 3: return { xs: 12, sm: 6, md: 6, lg: 4, xl: 4 }\n        }\n    }\n\n    if (drawerType != DrawerType.None)\n        return { xs: 12, md: 6, sm: 6, lg: 6, xl: 4 }\n    else return {\n        xs: 12,\n        sm: 6,\n        md: 4,\n        lg: 4,\n        xl: 3\n    }\n}","import React, { useContext, useEffect, useState } from \"react\";\nimport { JSONTryParse, readBlobToText, readBlobToUint8Array } from \"../../jacdac-ts/src/jdom/utils\";\nimport DbContext, { DB_VALUE_CHANGE } from \"./DbContext\";\nimport useEffectAsync from \"./useEffectAsync\";\n\nexport function useDbBlob(id: string) {\n    const { db } = useContext(DbContext)\n    const [_value, _setValue] = useState<Blob>(undefined)\n    const values = db?.blobs\n\n    // listen to change\n    useEffect(() => {\n        let _mounted = true;\n        return values?.subscribe(DB_VALUE_CHANGE, async (changed) => {\n            if (changed === id) {\n                try {\n                    const v = await values.get(id)\n                    if (_mounted) {\n                        _setValue(v);\n                    }\n                }\n                catch (e) {\n                    console.log(e)\n                    await values?.set(id, undefined);\n                }\n            }\n            return () => {\n                _mounted = false;\n            }\n        })\n    }, [values])\n\n    // load intial value\n    useEffectAsync(async (mounted) => {\n        try {\n            const v = await values?.get(id);\n            if (mounted())\n                _setValue(v)\n        } catch (e) {\n            console.log(e)\n            // trash data\n            await values?.set(id, undefined);\n        }\n    }, [values])\n\n    return {\n        blob: _value,\n        setBlob: async (blob: Blob) => {\n            await values?.set(id, blob)\n        }\n    }\n}\n\nexport function useDbUint8Array(blobName: string) {\n    const { blob, setBlob } = useDbBlob(blobName)\n    const [model, setModel] = useState<Uint8Array>(undefined)\n\n    useEffectAsync(async (mounted) => {\n        if (!blob) {\n            setModel(undefined)\n        }\n        else {\n            const buf = await readBlobToUint8Array(blob);\n            if (mounted())\n                setModel(buf);\n        }\n    }, [blob])\n\n    return {\n        data: model,\n        setBlob\n    }\n}\n\nexport function useDbString(blobName: string) {\n    const { blob, setBlob } = useDbBlob(blobName)\n    const [model, setModel] = useState<string>(undefined)\n\n    useEffectAsync(async () => {\n        if (!blob) {\n            setModel(undefined)\n        }\n        else {\n            const t = await readBlobToText(blob);\n            setModel(t);\n        }\n    }, [blob])\n\n    return {\n        data: model,\n        setBlob\n    }\n}\n\nexport function useDbJSON<T>(blobName: string) {\n    const { data, setBlob } = useDbString(blobName);\n    const value: T = JSONTryParse(data) as T;\n    return {\n        value,\n        setBlob: async (blob: Blob) => {\n            await setBlob(blob)\n        }\n    }\n}\n","import Packet from \"../jdom/packet\"\nimport { REPORT_RECEIVE, SRV_MODEL_RUNNER } from \"../jdom/constants\"\nimport JDService from \"../jdom/service\"\nimport { ModelRunnerCmd, ModelRunnerReg } from \"../jdom/constants\"\nimport { bufferToArray, NumberFormat } from \"../jdom/buffer\"\nimport { OutPipe } from \"../jdom/pipes\"\nimport JDRegister from \"../jdom/register\"\nimport { JDServiceClient } from \"../jdom/serviceclient\"\nimport { serviceSpecificationFromClassIdentifier } from \"../jdom/spec\"\nimport { jdunpack } from \"../jdom/pack\"\nimport { assert, read32, toHex, uint8ArrayToString } from \"../jdom/utils\"\n\n/*\n    enum SampleType : u8 {\n        U8 = 0x08\n        I8 = 0x88\n        U16 = 0x10\n        I16 = 0x90\n        U32 = 0x20\n        I32 = 0xA0\n    }\n    rw inputs @ 0x80 {\n        sampling_interval: u16 ms\n        samples_in_window: u16\n        reserved: u32\n    repeats:\n        device_id: devid\n        service_class: u32\n        service_num: u8\n        sample_size: u8 B\n        sample_type: SampleType\n        sample_shift: i8\n    }\n*/\n\nexport function isMLModelSupported(model: Uint8Array, formatRegValue: number) {\n    return (\n        read32(model, 0) == formatRegValue || read32(model, 4) == formatRegValue\n    )\n}\n\nexport function getMLModelFormatName(model: Uint8Array) {\n    const map =\n        serviceSpecificationFromClassIdentifier(SRV_MODEL_RUNNER).enums[\n            \"ModelFormat\"\n        ].members\n    const m0 = read32(model, 0)\n    const m1 = read32(model, 4)\n    for (const v of Object.keys(map)) {\n        if (map[v] == m0 || map[v] == m1) return v\n    }\n    return \"0x\" + toHex(model.slice(0, 8))\n}\n\n/**\n * A client for the model runner service\n * @category Clients\n */\nexport class ModelRunnerClient extends JDServiceClient {\n    constructor(service: JDService) {\n        super(service)\n        assert(service.serviceClass == SRV_MODEL_RUNNER)\n        this.service.registersUseAcks = true\n    }\n\n    // TODO this should use some caching?\n    async isModelSupported(model: Uint8Array) {\n        const reg = this.service.register(ModelRunnerReg.Format)\n        await reg.refresh()\n        return reg.data == null || isMLModelSupported(model, reg.intValue >>> 0)\n    }\n\n    subscribeResults(handler: (sample: number[]) => void): () => void {\n        const reg = this.service.register(ModelRunnerReg.Outputs)\n        return reg.subscribe(REPORT_RECEIVE, () => {\n            handler(bufferToArray(reg.data, NumberFormat.Float32LE))\n        })\n    }\n\n    async deployModel(model: Uint8Array, onProgress?: (p: number) => void) {\n        onProgress?.(0)\n        const resp = await this.service.sendCmdAwaitResponseAsync(\n            Packet.jdpacked(ModelRunnerCmd.SetModel, \"u32\", [model.length]),\n            3000\n        )\n        onProgress?.(0.05)\n        const [pipePort] = jdunpack<[number]>(resp.data, \"u16\")\n        if (!pipePort) throw new Error(\"wrong port \" + pipePort)\n        const pipe = new OutPipe(this.service.device, pipePort)\n        const chunkSize = 224 // has to be divisible by 8\n        for (let i = 0; i < model.length; i += chunkSize) {\n            await pipe.send(model.slice(i, i + chunkSize))\n            onProgress?.(0.05 + (i / model.length) * 0.9)\n        }\n        try {\n            await pipe.close()\n        } catch {\n            // the device may restart before we manage to close\n        }\n        onProgress?.(1)\n    }\n\n    async autoInvoke(everySamples = 1) {\n        await this.service\n            .register(ModelRunnerReg.AutoInvokeEvery)\n            .sendSetPackedAsync([everySamples])\n    }\n\n    private async getReg(id: ModelRunnerReg, f: (v: JDRegister) => any) {\n        const reg = this.service.register(id)\n        await reg.refresh()\n        return f(reg)\n    }\n\n    async modelStats(): Promise<TFModelStats> {\n        const info: any = {\n            modelSize: this.getReg(ModelRunnerReg.ModelSize, r => r.intValue),\n            arenaSize: this.getReg(\n                ModelRunnerReg.AllocatedArenaSize,\n                r => r.intValue\n            ),\n            inputShape: this.getReg(ModelRunnerReg.InputShape, r =>\n                bufferToArray(r.data, NumberFormat.UInt16LE)\n            ),\n            outputShape: this.getReg(ModelRunnerReg.OutputShape, r =>\n                bufferToArray(r.data, NumberFormat.UInt16LE)\n            ),\n            lastError: this.getReg(ModelRunnerReg.LastError, r =>\n                uint8ArrayToString(r.data)\n            ),\n        }\n        for (const id of Object.keys(info)) {\n            info[id] = await info[id]\n        }\n        return info\n    }\n}\nexport default ModelRunnerClient\n\nexport interface TFModelStats {\n    modelSize: number\n    arenaSize: number\n    inputShape: number[]\n    outputShape: number[]\n    lastError: string\n}\n\n/*\nexport async function testAGG(bus: JDBus) {\n    const aggService = bus.services({ serviceClass: SRV_SENSOR_AGGREGATOR })[0]\n    if (!aggService) {\n        console.log(\"no agg service\")\n        return\n    }\n    const agg = new SensorAggregatorClient(aggService)\n\n    let acc = bus.services({ serviceClass: SRV_ACCELEROMETER })\n    if (acc.length == 0) {\n        console.log(\"no acc service\")\n        return\n    }\n\n    await agg.setInputs({\n        samplesInWindow: 50,\n        samplingInterval: 20,\n        inputs: acc\n    })\n\n    agg.subscribeSample(sample => {\n        console.log(\"SAMPLE\", sample)\n    })\n\n}\n\nexport async function testTF(bus: JDBus, model: Uint8Array) {\n    const tfService = bus.services({ serviceClass: SRV_MODEL_RUNNER })[0]\n    if (!tfService) {\n        console.log(\"no tflite service\")\n        return\n    }\n    const tf = new TFLiteClient(tfService)\n\n    if (model)\n        await tf.deployModel(model, p => console.log(\"deploy\", p.toFixed(3)))\n\n    const st = await tf.modelStats()\n    console.log(st)\n\n    const classNames = ['noise', 'punch', 'left', 'right'];\n    tf.subscribeResults(outp => {\n        for (let i = 0; i < outp.length; ++i) {\n            if (outp[i] > 0.7) {\n                console.log(outp[i].toFixed(3) + \" \" + classNames[i])\n            }\n        }\n         console.log(\"OUT\", outp)\n    })\n\n    await tf.autoInvoke(8)\n\n    console.log(\"autoinvoked\")\n\n}\n*/\n","import { Paper } from \"@material-ui/core\"\nimport React, { useContext } from \"react\"\nimport { serviceName } from \"../../jacdac-ts/src/jdom/pretty\"\nimport {\n    SensorAggregatorConfig,\n    SensorAggregatorInputConfig,\n} from \"../../jacdac-ts/src/clients/sensoraggregatorclient\"\nimport JacdacContext, { JacdacContextProps } from \"../jacdac/Context\"\nimport DeviceName from \"./devices/DeviceName\"\n\nfunction SensorAggregatorInputConfigView(props: {\n    input: SensorAggregatorInputConfig\n}) {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { input } = props\n    const { serviceClass, deviceId, serviceIndex } = input\n\n    const device = deviceId && bus.device(deviceId)\n\n    return (\n        <>\n            {serviceName(serviceClass)}\n            {device && (\n                <DeviceName device={device} serviceIndex={serviceIndex} />\n            )}\n            {!device && deviceId && (\n                <span>\n                    {deviceId}[{serviceIndex}]\n                </span>\n            )}\n            {!deviceId && <span>/ any device</span>}\n        </>\n    )\n}\n\nexport default function SensorAggregatorConfigView(props: {\n    config: SensorAggregatorConfig\n}) {\n    const { config } = props\n\n    if (!config?.inputs) return <></>\n\n    return (\n        <Paper>\n            <ul>\n                <li>\n                    samples interval (ms):{\" \"}\n                    <code>{config.samplingInterval}</code>\n                </li>\n                <li>\n                    samples window (# samples):{\" \"}\n                    <code>{config.samplesInWindow}</code>\n                </li>\n                <li>\n                    inputs ({config.inputs.length})\n                    <ul>\n                        {config.inputs.map((input, i) => (\n                            <li key={\"input\" + i}>\n                                <SensorAggregatorInputConfigView\n                                    input={input}\n                                />\n                            </li>\n                        ))}\n                    </ul>\n                </li>\n            </ul>\n        </Paper>\n    )\n}\n","import React, { useContext, useState } from \"react\";\nimport Alert from \"./ui/Alert\";\nimport AppContext from \"./AppContext\";\n\nexport type ProgressHandler = (p: number) => void\n\nexport default function useCall() {\n    const { setError: setAppError } = useContext(AppContext)\n    const [error, setError] = useState<Error>();\n    const [running, setRunning] = useState(false)\n    const [progress, setProgress] = useState(0);\n\n    const handleProgress = (p: number) => setProgress(p);\n\n    const call = (handler: (onProgress?: ProgressHandler) => void) => {\n        try {\n            setRunning(true)\n            setError(undefined)\n            handler(handleProgress);\n        } catch (e) {\n            setError(e)\n            setAppError(e)\n        }\n        finally {\n            setRunning(false)\n        }\n    }\n    const callAsync = async (handler: (onProgress?: (p: number) => void) => Promise<void>) => {\n        try {\n            setRunning(true)\n            setError(undefined)\n            await handler(handleProgress);\n        } catch (e) {\n            setError(e)\n            setAppError(e)\n        }\n        finally {\n            setRunning(false)\n        }\n    }\n    const alert = error && <Alert severity=\"error\">{error}</Alert>\n\n    return {\n        running,\n        error,\n        progress,\n        alert,\n        call,\n        callAsync\n    }\n} ","import * as React from 'react';\nimport createSvgIcon from './utils/createSvgIcon';\nexport default createSvgIcon( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"\n}), 'Link');","import { List, ListItem, ListItemText, Typography } from \"@material-ui/core\"\nimport React, { lazy, useContext, useState } from \"react\"\nimport {\n    SRV_SENSOR_AGGREGATOR,\n    SRV_MODEL_RUNNER,\n    ModelRunnerReg,\n} from \"../../../jacdac-ts/src/jdom/constants\"\nimport JDService from \"../../../jacdac-ts/src/jdom/service\"\nimport ServiceList from \"../../components/ServiceList\"\nimport ConnectAlert from \"../../components/alert/ConnectAlert\"\nimport { useDbJSON, useDbUint8Array } from \"../../components/useDb\"\nimport Alert from \"../../components/ui/Alert\"\nimport { Button } from \"gatsby-theme-material-ui\"\nimport ModelRunnerClient from \"../../../jacdac-ts/src/clients/modelrunnerclient\"\nimport RegisterInput from \"../../components/RegisterInput\"\nimport CircularProgressWithLabel from \"../../components/ui/CircularProgressWithLabel\"\nimport SensorAggregatorClient, {\n    SensorAggregatorConfig,\n} from \"../../../jacdac-ts/src/clients/sensoraggregatorclient\"\nimport SensorAggregatorConfigView from \"../../components/SensorAggregatorConfigView\"\nimport ServiceManagerContext from \"../../components/ServiceManagerContext\"\nimport useChange from \"../../jacdac/useChange\"\nimport { IFile } from \"../../../jacdac-ts/src/embed/protocol\"\nimport { prettySize } from \"../../../jacdac-ts/src/jdom/pretty\"\nimport RegisterTrend from \"../../components/RegisterTrend\"\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\"\nimport useCall from \"../../components/useCall\"\n\nimport Suspense from \"../../components/ui/Suspense\"\nimport { Link } from \"@material-ui/icons\"\nimport useRegister from \"../../components/hooks/useRegister\"\nconst ImportButton = lazy(() => import(\"../../components/ImportButton\"))\n\nexport function ModelContent(props: { service: JDService }) {\n    const { service } = props\n\n    const modelSizeRegister = useRegister(service, ModelRunnerReg.ModelSize)\n    const lastErrorRegister = useRegister(service, ModelRunnerReg.LastError)\n    const autoInvokeEveryRegister = useRegister(\n        service,\n        ModelRunnerReg.AutoInvokeEvery\n    )\n    const outputsRegister = useRegister(service, ModelRunnerReg.Outputs)\n\n    const [modelSize] = useRegisterUnpackedValue<[number]>(modelSizeRegister)\n    const [lastError] = useRegisterUnpackedValue<[number]>(lastErrorRegister)\n\n    return (\n        <>\n            {lastError && <Alert severity=\"warning\">{lastError}</Alert>}\n            <Typography>\n                model size:{\" \"}\n                {modelSize === undefined ? \"...\" : prettySize(modelSize)}\n            </Typography>\n            <RegisterInput register={autoInvokeEveryRegister} visible={true} />\n            <RegisterTrend showName register={outputsRegister} mini={true} />\n        </>\n    )\n}\n\nexport function ModelActions(props: {\n    service: JDService\n    model: Uint8Array\n    sensorAggregatorService?: JDService\n    sensorInput?: SensorAggregatorConfig\n}) {\n    const { service, model, sensorAggregatorService, sensorInput } = props\n    const { running, progress, alert, callAsync } = useCall()\n\n    const modelDisabled = !service || !model || running\n\n    const handleDeployModel = async () =>\n        await callAsync(async setProgress => {\n            if (sensorAggregatorService && sensorInput) {\n                const aggregator = new SensorAggregatorClient(\n                    sensorAggregatorService\n                )\n                await aggregator.setInputs(sensorInput)\n            }\n            if (service && model) {\n                const runner = new ModelRunnerClient(service)\n                await runner.deployModel(model, setProgress)\n            }\n        })\n\n    return (\n        <>\n            {!running && (\n                <Button\n                    disabled={modelDisabled}\n                    variant=\"contained\"\n                    color=\"primary\"\n                    onClick={handleDeployModel}\n                >\n                    {sensorInput\n                        ? \"Deploy model and configuration\"\n                        : \"Deploy model\"}\n                </Button>\n            )}\n            {running && <CircularProgressWithLabel value={progress * 100} />}\n            {alert}\n        </>\n    )\n}\n\nexport default function ModelUploader() {\n    const [importing, setImporting] = useState(false)\n    const { data: model, setBlob: setModel } = useDbUint8Array(\"model.tflite\")\n    const { value: sensorConfig, setBlob: setSensorConfig } =\n        useDbJSON<SensorAggregatorConfig>(\"sensor-input.json\")\n    const { modelStore } = useContext(ServiceManagerContext)\n\n    const handleTfmodelFiles = async (files: File[]) => {\n        const file = files[0]\n        if (file) {\n            try {\n                setImporting(true)\n                await setModel(file)\n            } finally {\n                setImporting(false)\n            }\n        }\n    }\n    const handleClearModel = async () => {\n        try {\n            setImporting(true)\n            await setModel(undefined)\n        } finally {\n            setImporting(false)\n        }\n    }\n    const handleSensorConfigFiles = async (files: File[]) => {\n        const file = files[0]\n        if (file) {\n            try {\n                setImporting(true)\n                await setSensorConfig(file)\n            } finally {\n                setImporting(false)\n            }\n        }\n    }\n    const handleClearConfiguration = async () => {\n        try {\n            setImporting(true)\n            await setSensorConfig(undefined)\n        } finally {\n            setImporting(false)\n        }\n    }\n    const handleLoadModel = (model: IFile) => async () => {\n        try {\n            setImporting(true)\n            console.log(`loading model`, model)\n            const blob = await modelStore.loadFile(model)\n            console.log(`loaded content`, blob)\n            if (blob) {\n                setModel(blob)\n            }\n        } finally {\n            setImporting(false)\n        }\n    }\n    const handleLoadInputConfiguration = (model: IFile) => async () => {\n        try {\n            setImporting(true)\n            console.log(`loading model`, model)\n            const blob = await modelStore.loadFile(model)\n            console.log(`loaded content`, blob)\n            if (blob) {\n                setSensorConfig(blob)\n            }\n        } finally {\n            setImporting(false)\n        }\n    }\n\n    const models = useChange(modelStore, _ => _?.models())\n    const inputConfigurations = useChange(modelStore, _ =>\n        _?.inputConfigurations()\n    )\n\n    return (\n        <>\n            <h1>Model uploader</h1>\n            <p>\n                Upload Machine Learning Models (like TensorFlow Lite) into your{\" \"}\n                <Link to=\"/services/model-runner/\">ML module runners</Link>.\n            </p>\n            <h3>Load a machine learning model</h3>\n            <p>\n                Machine learning models are typically stored in a{\" \"}\n                <code>.tflite</code> file.\n            </p>\n            {model && (\n                <Alert severity={\"success\"}>\n                    Model loaded ({prettySize(model.byteLength)})\n                </Alert>\n            )}\n            {model && <p />}\n            <Suspense>\n                <ImportButton\n                    disabled={importing}\n                    text={\"Import model\"}\n                    onFilesUploaded={handleTfmodelFiles}\n                />\n            </Suspense>\n            <Button\n                aria-label=\"clear model\"\n                disabled={importing}\n                onClick={handleClearModel}\n            >\n                clear model\n            </Button>\n            {models?.length && (\n                <List>\n                    {models.map(model => (\n                        <ListItem\n                            key={model.path}\n                            button\n                            onClick={handleLoadModel(model)}\n                        >\n                            <ListItemText\n                                primary={model.name}\n                                secondary={`${model.path} ${prettySize(\n                                    model.size\n                                )}`}\n                            />\n                        </ListItem>\n                    ))}\n                </List>\n            )}\n            <h3>Configure sensors</h3>\n            <p>\n                Sensor configuration files are stored in a <code>.jd.json</code>{\" \"}\n                file.\n            </p>\n            {sensorConfig && (\n                <Alert severity={\"success\"}>Sensor configuration loaded</Alert>\n            )}\n            {sensorConfig && (\n                <SensorAggregatorConfigView config={sensorConfig} />\n            )}\n            {sensorConfig && <p />}\n            <Suspense>\n                <ImportButton\n                    disabled={importing}\n                    text={\"Import configuration\"}\n                    onFilesUploaded={handleSensorConfigFiles}\n                />\n            </Suspense>\n            <Button\n                aria-label=\"clear configuration\"\n                disabled={importing}\n                onClick={handleClearConfiguration}\n            >\n                clear configuration\n            </Button>\n            {inputConfigurations?.length && (\n                <List>\n                    {inputConfigurations.map(iconfig => (\n                        <ListItem\n                            key={iconfig.path}\n                            button\n                            onClick={handleLoadInputConfiguration(iconfig)}\n                        >\n                            <ListItemText\n                                primary={iconfig.name}\n                                secondary={`${iconfig.path} ${prettySize(\n                                    iconfig.size\n                                )}`}\n                            />\n                        </ListItem>\n                    ))}\n                </List>\n            )}\n            <h3>Deploy model to machine learning services</h3>\n            <ConnectAlert serviceClass={SRV_MODEL_RUNNER} />\n            <ServiceList\n                serviceClass={SRV_MODEL_RUNNER}\n                content={service => <ModelContent service={service} />}\n                actions={service => (\n                    <ModelActions\n                        service={service}\n                        model={model}\n                        sensorAggregatorService={\n                            service?.device.services({\n                                serviceClass: SRV_SENSOR_AGGREGATOR,\n                            })?.[0]\n                        }\n                        sensorInput={sensorConfig}\n                    />\n                )}\n            />\n        </>\n    )\n}\n"],"names":["SensorAggregatorReg","SensorAggregatorSampleType","SRV_SENSOR_AGGREGATOR","bufferToArray","NumberFormat","JD_SERIAL_MAX_PAYLOAD_SIZE","REPORT_RECEIVE","jdpack","JDServiceClient","isReading","serviceSpecificationFromClassIdentifier","assert","bufferConcat","bufferConcatMany","fromHex","SensorAggregatorClient","service","serviceClass","registersUseAcks","setInputs","cfg","error","msg","Error","mapType","tp","U8","U16","U32","I8","I16","I32","inputs","totalSampleSize","map","input","deviceId","serviceIndex","specification","toString","freeze","readingReg","packets","find","sampleType","undefined","sampleSize","sampleShift","field","fields","Math","abs","storage","shift","Uint8Array","unshift","samplingInterval","samplesInWindow","register","Inputs","sendSetAsync","collect","numSamples","StreamingSamples","sendSetPackedAsync","subscribeSample","handler","reg","CurrentSample","mount","subscribe","data","Float32LE","getReg","id","f","refresh","stats","info","NumSamples","r","intValue","SampleSize","Object","keys","React","useContext","Grid","CardContent","Card","CardActions","Switch","Box","useChange","JacdacContext","useGridBreakpoints","DeviceCardHeader","DeviceLostAlert","Alert","ServiceListItem","props","content","checked","checkedDisabled","toggleChecked","actions","device","handleCheck","ServiceList","selected","toggleSelected","alertMissing","bus","services","n","gridBreakpoints","length","handleSelected","handleChecked","serviceContent","serviceActions","NoSsr","ConnectButtons","NoSsrConnectAlert","closeable","transports","devices","b","ignoreSelf","spec","name","ConnectAlert","CircularProgress","Typography","CircularProgressWithLabel","round","value","AppContext","DrawerType","itemCount","drawerType","xs","sm","md","lg","xl","None","useEffect","useState","JSONTryParse","readBlobToText","readBlobToUint8Array","DbContext","DB_VALUE_CHANGE","useEffectAsync","useDbBlob","db","_value","_setValue","values","blobs","_mounted","changed","v","get","e","console","log","set","mounted","blob","setBlob","useDbUint8Array","blobName","model","setModel","buf","useDbString","t","useDbJSON","Packet","SRV_MODEL_RUNNER","ModelRunnerCmd","ModelRunnerReg","OutPipe","jdunpack","read32","toHex","uint8ArrayToString","isMLModelSupported","formatRegValue","getMLModelFormatName","enums","members","m0","m1","slice","ModelRunnerClient","isModelSupported","Format","subscribeResults","Outputs","deployModel","onProgress","resp","sendCmdAwaitResponseAsync","jdpacked","SetModel","pipePort","pipe","chunkSize","i","send","close","autoInvoke","everySamples","AutoInvokeEvery","modelStats","modelSize","ModelSize","arenaSize","AllocatedArenaSize","inputShape","InputShape","UInt16LE","outputShape","OutputShape","lastError","LastError","Paper","serviceName","DeviceName","SensorAggregatorInputConfigView","SensorAggregatorConfigView","config","useCall","setError","setAppError","running","setRunning","progress","setProgress","handleProgress","p","call","callAsync","alert","List","ListItem","ListItemText","lazy","Button","RegisterInput","ServiceManagerContext","prettySize","RegisterTrend","useRegisterUnpackedValue","Suspense","Link","useRegister","ImportButton","ModelContent","modelSizeRegister","lastErrorRegister","autoInvokeEveryRegister","outputsRegister","ModelActions","sensorAggregatorService","sensorInput","modelDisabled","handleDeployModel","aggregator","runner","ModelUploader","importing","setImporting","sensorConfig","setSensorConfig","modelStore","handleTfmodelFiles","files","file","handleClearModel","handleSensorConfigFiles","handleClearConfiguration","handleLoadModel","loadFile","handleLoadInputConfiguration","models","_","inputConfigurations","byteLength","path","size","iconfig"],"sourceRoot":""}