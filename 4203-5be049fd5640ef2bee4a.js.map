{"version":3,"file":"4203-5be049fd5640ef2bee4a.js","mappings":"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","sources":["webpack://jacdac-docs/./node_modules/@material-ui/icons/Fullscreen.js","webpack://jacdac-docs/./src/components/ui/WebCam.tsx"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z\"\n}), 'Fullscreen');\n\nexports.default = _default;","/* eslint-disable jsx-a11y/media-has-caption */\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardMedia,\n    createStyles,\n    FormControl,\n    makeStyles,\n    MenuItem,\n    Select,\n} from \"@material-ui/core\"\nimport React, {\n    ChangeEvent,\n    lazy,\n    useContext,\n    useEffect,\n    useRef,\n    useState,\n} from \"react\"\nimport useLocalStorage from \"../hooks/useLocalStorage\"\nimport useEffectAsync from \"../useEffectAsync\"\nimport SettingsIcon from \"@material-ui/icons/Settings\"\nimport IconButtonWithTooltip from \"./IconButtonWithTooltip\"\nimport useMounted from \"../hooks/useMounted\"\nimport Suspense from \"./Suspense\"\nimport CloseIcon from \"@material-ui/icons/Close\"\nimport AppContext from \"../AppContext\"\nimport { Alert } from \"@material-ui/lab\"\nimport FullscreenIcon from \"@material-ui/icons/Fullscreen\"\nconst Draggable = lazy(() => import(\"react-draggable\"))\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        cardContainer: {\n            zIndex: 1101,\n            position: \"absolute\",\n            left: \"5rem\",\n            top: \"5rem\",\n        },\n        card: {\n            \"& .hostedcontainer\": {\n                position: \"relative\",\n                width: \"30vw\",\n            },\n            \"& video\": {\n                border: \"none\",\n                position: \"relative\",\n                width: \"100%\",\n                height: \"100%\",\n            },\n        },\n    })\n)\n\nasync function requestVideoStream() {\n    // first ask for permission from ther user so that\n    // labels are populated in enumerateDevices\n    return await navigator.mediaDevices.getUserMedia({\n        audio: false,\n        video: true,\n    })\n}\n\nexport default function WebCam() {\n    const { setShowWebCam } = useContext(AppContext)\n    const [devices, setDevices] = useState<MediaDeviceInfo[]>()\n    const [deviceId, setDeviceId] = useLocalStorage(\"webcam_deviceid\", \"\")\n    const nodeRef = useRef<HTMLSpanElement>()\n    const streamRef = useRef<MediaStream>()\n    const videoRef = useRef<HTMLVideoElement>()\n    const [settingsOpen, setSettingsOpen] = useState(!deviceId)\n    const mounted = useMounted()\n    const classes = useStyles()\n\n    const handleClose = () => setShowWebCam(false)\n    const handleSettings = () => setSettingsOpen(newValue => !newValue)\n    const handleDeviceChange = (\n        ev: ChangeEvent<{ name?: string; value: unknown }>\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ) => setDeviceId(ev.target.value as any as string)\n    const handleFullScreen = () => videoRef.current?.requestFullscreen()\n    const stop = () => {\n        const stream = streamRef.current\n        if (stream) {\n            try {\n                const tracks = stream.getTracks()\n                if (tracks) tracks.forEach(track => track.stop())\n            } catch (e) {\n                console.debug(e)\n            }\n            streamRef.current = undefined\n        }\n        const video = videoRef.current\n        if (video) {\n            try {\n                video.srcObject = undefined\n            } catch (e) {\n                console.debug(e)\n            }\n        }\n    }\n\n    // start camera\n    useEffectAsync(async () => {\n        console.debug(`greenscreen: start`)\n        // deviceId is \"\" if green screen selected\n        if (deviceId) {\n            console.debug(`greenscreen: stream acquired`)\n            try {\n                const stream = await navigator.mediaDevices.getUserMedia({\n                    video: { advanced: [{ deviceId: deviceId }] },\n                    audio: false,\n                })\n                streamRef.current = stream\n                const video = videoRef.current\n                video.srcObject = stream\n                video.play()\n\n                if (mounted()) setSettingsOpen(false)\n            } catch (e) {\n                console.debug(`greenscreen: play failed`)\n                console.error(e)\n                if (mounted()) setDeviceId(undefined)\n            }\n        }\n    }, [deviceId])\n\n    const updateDevices = async () => {\n        try {\n            // enumerate devices\n            const devices = await navigator.mediaDevices.enumerateDevices()\n            const webcams = devices.filter(\n                device => device.kind == \"videoinput\"\n            )\n            if (mounted()) {\n                setDevices(webcams)\n                if (!webcams.find(webcam => webcam.deviceId === deviceId)) {\n                    const did = webcams[0]?.deviceId\n                    setDeviceId(did)\n                }\n            }\n        } catch (e) {\n            if (mounted()) setDevices([])\n        }\n    }\n\n    // startup\n    useEffectAsync(async () => {\n        // first ask for permission from ther user so that\n        // labels are populated in enumerateDevices\n        await requestVideoStream()\n        await updateDevices()\n    }, [])\n\n    useEffect(() => {\n        navigator.mediaDevices.addEventListener(\"devicechange\", updateDevices)\n        return () =>\n            navigator.mediaDevices.removeEventListener(\n                \"devicechange\",\n                updateDevices\n            )\n    })\n\n    // cleanup\n    useEffect(() => stop, [deviceId])\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const draggableProps: any = {\n        nodeRef,\n    }\n\n    return (\n        <Suspense>\n            <Draggable {...draggableProps}>\n                <span ref={nodeRef} className={classes.cardContainer}>\n                    <Card className={classes.card}>\n                        <CardHeader\n                            title={\n                                settingsOpen &&\n                                devices && (\n                                    <FormControl\n                                        variant=\"outlined\"\n                                        size=\"small\"\n                                    >\n                                        <Select\n                                            title=\"select a webcam\"\n                                            open={settingsOpen}\n                                            onChange={handleDeviceChange}\n                                            value={deviceId}\n                                        >\n                                            {devices?.map(\n                                                ({ deviceId, label }) => (\n                                                    <MenuItem\n                                                        key={deviceId}\n                                                        value={deviceId}\n                                                    >\n                                                        {label}\n                                                    </MenuItem>\n                                                )\n                                            )}\n                                        </Select>\n                                    </FormControl>\n                                )\n                            }\n                            action={\n                                <>\n                                    <IconButtonWithTooltip\n                                        size=\"small\"\n                                        onClick={handleFullScreen}\n                                        title=\"full screen\"\n                                    >\n                                        <FullscreenIcon />\n                                    </IconButtonWithTooltip>\n                                    <IconButtonWithTooltip\n                                        size=\"small\"\n                                        onClick={handleSettings}\n                                        title=\"Settings\"\n                                    >\n                                        <SettingsIcon />\n                                    </IconButtonWithTooltip>\n                                    <IconButtonWithTooltip\n                                        size=\"small\"\n                                        onClick={handleClose}\n                                        title=\"Close\"\n                                    >\n                                        <CloseIcon />\n                                    </IconButtonWithTooltip>\n                                </>\n                            }\n                        />\n                        {!devices && (\n                            <CardContent>\n                                <Alert severity=\"warning\">\n                                    Please allow access to use your camera.\n                                </Alert>\n                            </CardContent>\n                        )}\n                        <CardMedia>\n                            <div className=\"hostedcontainer\">\n                                <video\n                                    autoPlay\n                                    playsInline\n                                    ref={videoRef}\n                                    title=\"webcam\"\n                                />\n                            </div>\n                        </CardMedia>\n                    </Card>\n                </span>\n            </Draggable>\n        </Suspense>\n    )\n}\n"],"names":["Card","CardContent","CardHeader","CardMedia","createStyles","FormControl","makeStyles","MenuItem","Select","React","lazy","useContext","useEffect","useRef","useState","useLocalStorage","useEffectAsync","SettingsIcon","IconButtonWithTooltip","useMounted","Suspense","CloseIcon","AppContext","Alert","FullscreenIcon","Draggable","useStyles","cardContainer","zIndex","position","left","top","card","width","border","height","requestVideoStream","navigator","mediaDevices","getUserMedia","audio","video","WebCam","setShowWebCam","devices","setDevices","deviceId","setDeviceId","nodeRef","streamRef","videoRef","settingsOpen","setSettingsOpen","mounted","classes","handleClose","handleSettings","newValue","handleDeviceChange","ev","target","value","handleFullScreen","current","requestFullscreen","stop","stream","tracks","getTracks","forEach","track","e","console","debug","undefined","srcObject","advanced","play","error","updateDevices","enumerateDevices","webcams","filter","device","kind","find","webcam","did","addEventListener","removeEventListener","draggableProps","map","label"],"sourceRoot":""}