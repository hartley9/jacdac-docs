{"version":3,"file":"component---src-pages-tools-makecode-editor-extension-tsx-3a5f5a83b5ad54e7e5b8.js","mappings":"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","sources":["webpack://jacdac-docs/./node_modules/@mui/icons-material/Add.js","webpack://jacdac-docs/./node_modules/@mui/icons-material/Delete.js","webpack://jacdac-docs/./src/components/AddServiceIconButton.tsx","webpack://jacdac-docs/./src/components/specification/ServiceSpecificationSelect.tsx","webpack://jacdac-docs/./src/components/ui/PaperBox.tsx","webpack://jacdac-docs/./src/components/hooks/useClient.ts","webpack://jacdac-docs/./src/components/makecode/MakeCodeEditorExtensionClient.ts","webpack://jacdac-docs/./src/components/makecode/MakeCodeEditorExtension.tsx","webpack://jacdac-docs/./src/pages/tools/makecode-editor-extension.tsx"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _jsxRuntime = require(\"react/jsx-runtime\");\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\"\n}), 'Add');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _jsxRuntime = require(\"react/jsx-runtime\");\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\"\n}), 'Delete');\n\nexports.default = _default;","import React, { useMemo, useState } from \"react\"\nimport { Menu, MenuItem, Typography } from \"@mui/material\"\nimport {\n    isInfrastructure,\n    serviceSpecificationFromClassIdentifier,\n    serviceSpecifications,\n} from \"../../jacdac-ts/src/jdom/spec\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport AddIcon from \"@mui/icons-material/Add\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport IconButtonWithTooltip from \"./ui/IconButtonWithTooltip\"\nimport { useId } from \"react-use-id-hook\"\n\nexport default function AddServiceIconButton(props: {\n    onAdd: (service: jdspec.ServiceSpec) => void\n    serviceFilter?: (service: jdspec.ServiceSpec) => boolean\n    error?: string\n    children?: JSX.Element | JSX.Element[]\n}) {\n    const { error, onAdd, children, serviceFilter } = props\n    const [servicesAnchorEl, setServicesAnchorEl] =\n        useState<null | HTMLElement>(null)\n    const servicesMenuId = useId()\n    const services = useMemo(\n        () =>\n            serviceSpecifications()\n                .filter(srv => !isInfrastructure(srv))\n                .filter(srv => !serviceFilter || serviceFilter(srv)),\n        [serviceFilter]\n    )\n\n    const handleServiceAddClick = (\n        event: React.MouseEvent<HTMLButtonElement>\n    ) => {\n        setServicesAnchorEl(event.currentTarget)\n    }\n    const handleServiceAddClose = (id: number) => () => {\n        setServicesAnchorEl(null)\n        if (id !== undefined) {\n            const srv = serviceSpecificationFromClassIdentifier(id)\n            onAdd(srv)\n        }\n    }\n\n    return (\n        <>\n            <IconButtonWithTooltip\n                title=\"Add a service\"\n                aria-controls={servicesMenuId}\n                aria-haspopup=\"true\"\n                onClick={handleServiceAddClick}\n            >\n                {children || <AddIcon />}\n            </IconButtonWithTooltip>\n            <Menu\n                id={servicesMenuId}\n                anchorEl={servicesAnchorEl}\n                keepMounted\n                open={Boolean(servicesAnchorEl)}\n                onClose={handleServiceAddClose(undefined)}\n            >\n                {services.map(srv => (\n                    <MenuItem\n                        key={srv.classIdentifier}\n                        value={srv.classIdentifier.toString(16)}\n                        onClick={handleServiceAddClose(srv.classIdentifier)}\n                    >\n                        {srv.name}\n                    </MenuItem>\n                ))}\n            </Menu>\n            <Typography\n                variant=\"caption\"\n                color={error ? \"error\" : \"inherit\"}\n                component=\"div\"\n            >\n                {error || \"Select one or more services.\"}\n            </Typography>\n        </>\n    )\n}\n","import { MenuItem, TextField } from \"@mui/material\"\nimport { styled } from \"@mui/material/styles\"\nimport React, { ChangeEvent, useMemo, useState } from \"react\"\nimport { serviceSpecifications } from \"../../../jacdac-ts/src/jdom/spec\"\nimport useDeviceCatalog from \"../devices/useDeviceCatalog\"\n\nconst PREFIX = \"ServiceSpecificationSelect\"\n\nconst classes = {\n    root: `${PREFIX}-root`,\n}\n\nconst StyledTextField = styled(TextField)(() => ({\n    [`&.${classes.root}`]: {\n        minWidth: \"18rem\",\n    },\n}))\n\nexport default function ServiceSpecificationSelect(props: {\n    label: string\n    serviceClass: number\n    setServiceClass: (serviceClass: number) => void\n    variant?: \"outlined\" | \"filled\" | \"standard\"\n    fullWidth?: boolean\n    error?: string\n    hasRegisteredDevice?: boolean\n}) {\n    const {\n        label,\n        serviceClass,\n        setServiceClass,\n        variant,\n        fullWidth,\n        error,\n        hasRegisteredDevice,\n    } = props\n    const [labelId] = useState(\"select-\" + Math.random())\n    const deviceCatalog = useDeviceCatalog()\n\n    const specs = useMemo(\n        () =>\n            serviceSpecifications()\n                .filter(spec => !/^_/.test(spec.shortId))\n                .filter(\n                    spec =>\n                        !hasRegisteredDevice ||\n                        !!deviceCatalog\n                            .specificationsForService(spec.classIdentifier)\n                            ?.filter(spec => spec.status !== \"deprecated\")\n                            ?.length\n                ),\n        [hasRegisteredDevice]\n    )\n\n    const handleChange = (event: ChangeEvent<HTMLInputElement>) =>\n        setServiceClass(parseInt(event.target.value))\n\n    return (\n        <StyledTextField\n            id={labelId}\n            className={classes.root}\n            label={label}\n            error={!!error}\n            helperText={error}\n            value={isNaN(serviceClass) ? \"\" : serviceClass}\n            select\n            variant={variant}\n            fullWidth={fullWidth}\n            onChange={handleChange}\n        >\n            <MenuItem key=\"none\" value=\"\">\n                No service selected\n            </MenuItem>\n            {specs.map(spec => (\n                <MenuItem\n                    key={spec.classIdentifier}\n                    value={spec.classIdentifier}\n                >\n                    {spec.name}\n                </MenuItem>\n            ))}\n        </StyledTextField>\n    )\n}\n","import { BoxProps, Paper } from \"@mui/material\"\nimport React from \"react\"\n\nexport default function PaperBox(\n    props: { padding?: number; elevation?: number; bgcolor?: string } & BoxProps\n) {\n    const { children, padding = 1, elevation = 1, bgcolor, ...others } = props\n    return (\n        <Paper\n            sx={{ mb: 1, bgcolor, p: padding, ...others }}\n            square\n            elevation={elevation}\n        >\n            {children}\n        </Paper>\n    )\n}\n","import { DependencyList, useEffect, useMemo } from \"react\"\nimport JDClient from \"../../../jacdac-ts/src/jdom/client\"\n\nexport default function useClient<TClient extends JDClient>(\n    factory: () => TClient,\n    deps?: DependencyList\n) {\n    const client = useMemo(factory, deps || [])\n    useEffect(() => () => client?.unmount(), [client])\n    return client\n}\n","import { useContext } from \"react\"\nimport { JDClient } from \"../../../jacdac-ts/src/jdom/client\"\nimport { CHANGE, CONNECT } from \"../../../jacdac-ts/src/jdom/constants\"\nimport { inIFrame } from \"../../../jacdac-ts/src/jdom/iframeclient\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport useClient from \"../hooks/useClient\"\nimport useEffectAsync from \"../useEffectAsync\"\n\nexport const READ = \"read\"\nexport const MESSAGE_PACKET = \"messagepacket\"\nconst HIDDEN = \"hidden\"\nconst SHOWN = \"shown\"\n\nexport interface ReadResponse {\n    code?: string\n    json?: string\n    jres?: string\n}\n\nexport class MakeCodeEditorExtensionClient extends JDClient {\n    private readonly pendingCommands: {\n        [key: string]: {\n            action: string\n            resolve: (resp: any) => void\n            reject: (e: any) => void\n        }\n    } = {}\n    private readonly extensionId: string = inIFrame()\n        ? window.location.hash.substr(1)\n        : undefined\n    private _target: { id: string } // full apptarget\n    private _connected = false\n    private _visible = false\n\n    constructor() {\n        super()\n        this.handleMessage = this.handleMessage.bind(this)\n        if (typeof window !== \"undefined\") {\n            window.addEventListener(\"message\", this.handleMessage, false)\n            this.mount(() =>\n                window.removeEventListener(\"message\", this.handleMessage)\n            )\n        }\n        // always refresh on load\n        this.on(SHOWN, () => this.refresh())\n        // notify parent that we're ready\n        this.init()\n    }\n\n    get target() {\n        return this._target\n    }\n\n    get connected() {\n        return this._connected\n    }\n\n    get visible() {\n        return this._visible\n    }\n\n    private setVisible(vis: boolean) {\n        if (this._visible !== vis) {\n            this._visible = vis\n            this.emit(CHANGE)\n        }\n    }\n\n    private nextRequestId = 1\n    private mkRequest(\n        resolve: (resp: any) => void,\n        reject: (e: any) => void,\n        action: string,\n        body?: any\n    ): any {\n        const id = \"jd_\" + this.nextRequestId++\n        this.pendingCommands[id] = { action, resolve, reject }\n        return {\n            type: \"pxtpkgext\",\n            action,\n            extId: this.extensionId,\n            response: true,\n            id,\n            body,\n        }\n    }\n\n    private sendRequest<T>(action: string, body?: any): Promise<T> {\n        this.log(`send ${action}`)\n        if (!this.extensionId) return Promise.resolve(undefined)\n\n        return new Promise((resolve, reject) => {\n            const msg = this.mkRequest(resolve, reject, action, body)\n            window.parent.postMessage(msg, \"*\")\n        })\n    }\n\n    private handleMessage(ev: any) {\n        const msg = ev.data\n        if (msg?.type !== \"pxtpkgext\") return\n        if (!msg.id) {\n            switch (msg.event) {\n                case \"extinit\":\n                    this.log(\"init\")\n                    this._target = msg.target\n                    this._connected = true\n                    this.emit(CONNECT)\n                    this.emit(CHANGE)\n                    break\n                case \"extloaded\":\n                    this.log(`loaded`)\n                    break\n                case \"extshown\":\n                    this.setVisible(true)\n                    this.emit(SHOWN)\n                    this.emit(CHANGE)\n                    break\n                case \"exthidden\":\n                    this.setVisible(false)\n                    this.emit(HIDDEN)\n                    this.emit(CHANGE)\n                    break\n                case \"extdatastream\":\n                    this.emit(\"datastream\", true)\n                    break\n                case \"extconsole\":\n                    this.emit(\"console\", msg.body)\n                    break\n                case \"extmessagepacket\":\n                    this.emit(MESSAGE_PACKET, msg.body)\n                    break\n                default:\n                    console.debug(\"Unhandled event\", msg)\n            }\n        } else {\n            const { action, resolve, reject } =\n                this.pendingCommands[msg.id] || {}\n            delete this.pendingCommands[msg.id]\n\n            if (msg.success && resolve) resolve(msg.resp)\n            else if (!msg.success && reject) reject(msg.resp)\n            // raise event as well\n            switch (action) {\n                case \"extinit\":\n                    this._target = msg.target\n                    this._connected = true\n                    this.emit(CONNECT)\n                    this.emit(CHANGE)\n                    break\n                case \"extusercode\":\n                    // Loaded, set the target\n                    this.emit(\"readuser\", msg.resp)\n                    this.emit(CHANGE)\n                    break\n                case \"extreadcode\":\n                    // Loaded, set the target\n                    this.emit(READ, msg.resp)\n                    this.emit(CHANGE)\n                    break\n                case \"extwritecode\":\n                    this.emit(\"written\", undefined)\n                    break\n            }\n        }\n    }\n\n    private async init() {\n        this.log(`initializing`)\n        await this.sendRequest<void>(\"extinit\")\n        this.log(`connected`)\n        await this.refresh()\n    }\n\n    private async refresh() {\n        this.log(`refresh`)\n        await this.read()\n    }\n\n    async read(): Promise<ReadResponse> {\n        if (!this.extensionId) {\n            const r: ReadResponse = {}\n            this.emit(READ, r)\n            return r\n        } else {\n            const resp: ReadResponse = await this.sendRequest(\"extreadcode\")\n            return resp\n        }\n    }\n\n    async readUser() {\n        await this.sendRequest(\"extusercode\")\n    }\n\n    async write(\n        code: string,\n        json?: string,\n        jres?: string,\n        dependencies?: Record<string, string>\n    ): Promise<void> {\n        if (!this.extensionId) {\n            // Write to local storage instead\n            this.emit(\"written\", undefined)\n        } else {\n            await this.sendRequest<void>(\"extwritecode\", {\n                code: code || undefined,\n                json: json || undefined,\n                jres: jres || undefined,\n                dependencies,\n            })\n        }\n    }\n\n    async queryPermission() {\n        await this.sendRequest(\"extquerypermission\")\n    }\n\n    async requestPermission(console: boolean) {\n        await this.sendRequest(\"extrequestpermission\", {\n            console,\n        })\n    }\n\n    async dataStreamConsole(console: boolean) {\n        await this.sendRequest(\"extdatastream\", {\n            console,\n        })\n    }\n\n    async dataStreamMessages(messages: boolean) {\n        await this.sendRequest(\"extdatastream\", {\n            messages,\n        })\n    }\n}\n\nexport default function useMakeCodeEditorExtensionClient() {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    useEffectAsync(() => bus.stop(), [])\n    const client = useClient(() => new MakeCodeEditorExtensionClient(), [])\n    return client\n}\n","import { Grid, TextField } from \"@mui/material\"\nimport React, { ChangeEvent, useEffect, useMemo, useState } from \"react\"\nimport {\n    clone,\n    JSONTryParse,\n    uniqueName,\n} from \"../../../jacdac-ts/src/jdom/utils\"\nimport useChange from \"../../jacdac/useChange\"\n// tslint:disable-next-line: no-submodule-imports match-default-export-name\nimport DeleteIcon from \"@mui/icons-material/Delete\"\nimport { serviceSpecifications } from \"../../../jacdac-ts/src/jdom/spec\"\nimport AddServiceIconButton from \"../AddServiceIconButton\"\nimport ServiceSpecificationSelect from \"../specification/ServiceSpecificationSelect\"\nimport IconButtonWithTooltip from \"../ui/IconButtonWithTooltip\"\nimport useMakeCodeEditorExtensionClient, {\n    READ,\n    ReadResponse,\n} from \"./MakeCodeEditorExtensionClient\"\nimport CmdButton from \"../CmdButton\"\n// tslint:disable-next-line: no-submodule-imports match-default-export-name\nimport SaveIcon from \"@mui/icons-material/Save\"\nimport { camelize } from \"../../../jacdac-ts/jacdac-spec/spectool/jdspec\"\nimport { useId } from \"react-use-id-hook\"\nimport {\n    resolveMakecodeService,\n    resolveMakecodeServiceFromClassIdentifier,\n} from \"./services\"\n\ninterface ClientRole {\n    name: string\n    service: number\n}\n\ninterface Configuration {\n    roles: ClientRole[]\n}\n\nfunction toTypescript(config: Configuration) {\n    const ns = \"myModules\"\n    return `// auto-generated, do not edit.\nnamespace ${ns} {\n${config.roles\n    .map(\n        role => `\n    //% fixedInstance block=\"${role.name}\"\n    export const ${camelize(role.name)} = new ${\n            resolveMakecodeServiceFromClassIdentifier(role.service).client.qName\n        }(\"${camelize(role.name)}\");\n`\n    )\n    .join(\"\")}\n\n    // start after main\n    control.runInParallel(function() {\n        ${config.roles\n            .map(\n                role => `    ${ns}.${camelize(role.name)}.start();\n        `\n            )\n            .join(\"\")}\n    })\n}\n    `\n}\n\nfunction toDependencies(config: Configuration) {\n    const r: Record<string, string> = {}\n    config?.roles.forEach(role => {\n        const mk = resolveMakecodeServiceFromClassIdentifier(role.service)\n        r[mk.client.name] = `github:${mk.client.repo}`\n    })\n    return r\n}\n\nfunction toJSON(config: Configuration) {\n    return config && JSON.stringify(config, null, 4)\n}\n\nfunction escapeName(name: string) {\n    // TODO: makecode component escape name\n    return name\n}\n\nfunction ClientRoleRow(props: {\n    config: Configuration\n    component: ClientRole\n    onUpdate: () => void\n}) {\n    const { component, onUpdate, config } = props\n    const { name, service } = component\n    const { nameError, serviceError } = useMemo(\n        () => validateClientRole(config, component),\n        [config, component]\n    )\n    const textId = useId()\n    const handleComponentNameChange = (ev: ChangeEvent<HTMLInputElement>) => {\n        component.name = escapeName(ev.target.value)\n        onUpdate()\n    }\n    const handleSetService = (serviceClass: number) => {\n        component.service = serviceClass\n        onUpdate()\n    }\n    const handleComponentDelete = () => {\n        config.roles.splice(config.roles.indexOf(component), 1)\n        onUpdate()\n    }\n    return (\n        <Grid item xs={12}>\n            <Grid container spacing={2}>\n                <Grid item xs={4} md={6}>\n                    <TextField\n                        id={textId}\n                        fullWidth={true}\n                        error={!!nameError}\n                        variant=\"outlined\"\n                        label=\"name\"\n                        helperText={nameError}\n                        value={name}\n                        onChange={handleComponentNameChange}\n                    />\n                </Grid>\n                <Grid item xs={4} md={4}>\n                    <ServiceSpecificationSelect\n                        variant=\"outlined\"\n                        label=\"service\"\n                        serviceClass={service}\n                        setServiceClass={handleSetService}\n                        error={serviceError}\n                    />\n                </Grid>\n                <Grid item>\n                    <IconButtonWithTooltip\n                        title=\"Remove service\"\n                        onClick={handleComponentDelete}\n                    >\n                        <DeleteIcon />\n                    </IconButtonWithTooltip>\n                </Grid>\n            </Grid>\n        </Grid>\n    )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction validateClientRole(config: Configuration, role: ClientRole) {\n    const serviceError: string = undefined\n    const nameError: string = undefined\n    // TODO: properly validate client role\n    return { serviceError, nameError }\n}\n\n/**\n * To test locally, add ?localeditorextensions=1&debugextensions=1\n */\nexport default function MakeCodeEditorExtension() {\n    const client = useMakeCodeEditorExtensionClient()\n    const target = useChange(client, _ => _?.target)\n    const connected = useChange(client, c => c?.connected)\n    const [configuration, setConfiguration] = useState<Configuration>({\n        roles: [],\n    } as Configuration)\n    useEffect(\n        () =>\n            client?.subscribe(READ, (resp: ReadResponse) => {\n                console.log(`mkcd: read received`)\n                const cfg = JSONTryParse<Configuration>(resp.json)\n                console.log({ resp, cfg })\n                if (cfg) setConfiguration(cfg)\n            }),\n        [client]\n    )\n    const hasMakeCodeService = (srv: jdspec.ServiceSpec) => {\n        const mkc = resolveMakecodeService(srv)\n        return (\n            mkc &&\n            target &&\n            (!mkc.client.targets || mkc.client.targets.indexOf(target.id) > -1)\n        )\n    }\n    const update = () => {\n        setConfiguration(clone(configuration))\n    }\n    const handleAddService = (service: jdspec.ServiceSpec) => {\n        if (!configuration.roles) configuration.roles = []\n        const names = configuration.roles\n            .map(c => c.name)\n            .concat(serviceSpecifications().map(spec => spec.camelName))\n            .filter(n => !!n)\n        configuration.roles.push({\n            name: uniqueName(names, service.camelName || service.shortId),\n            service: service.classIdentifier,\n        })\n        update()\n    }\n    const handleSave = async () => {\n        const ts = toTypescript(configuration)\n        const json = toJSON(configuration)\n        const deps = toDependencies(configuration)\n        console.log(`mkcd: saving...`)\n        await client.write(ts, json, undefined, deps)\n    }\n\n    return (\n        <Grid container direction=\"row\" spacing={2}>\n            {configuration.roles?.map((c, i) => (\n                <ClientRoleRow\n                    key={\"config\" + i}\n                    config={configuration}\n                    component={c}\n                    onUpdate={update}\n                />\n            ))}\n            <Grid item xs={12}>\n                <AddServiceIconButton\n                    serviceFilter={hasMakeCodeService}\n                    onAdd={handleAddService}\n                />\n            </Grid>\n            <Grid item xs={12}>\n                <CmdButton\n                    trackName=\"makecode.save\"\n                    variant=\"contained\"\n                    disabled={!connected}\n                    icon={<SaveIcon />}\n                    onClick={handleSave}\n                >\n                    save\n                </CmdButton>\n            </Grid>\n        </Grid>\n    )\n}\n","import React, { useContext, useEffect } from \"react\"\nimport { styled } from \"@mui/material/styles\"\nimport { createTheme, responsiveFontSizes } from \"@mui/material\"\nimport ThemedLayout from \"../../components/ui/ThemedLayout\"\nimport MakeCodeEditorExtension from \"../../components/makecode/MakeCodeEditorExtension\"\nimport PaperBox from \"../../components/ui/PaperBox\"\nimport DarkModeContext from \"../../components/ui/DarkModeContext\"\n\nconst PREFIX = \"makecode-editor-extension\"\n\nconst classes = {\n    content: `${PREFIX}-content`,\n}\n\nconst Root = styled(\"div\")(({ theme }) => ({\n    [`& .${classes.content}`]: {\n        display: \"flex\",\n        minHeight: \"100vh\",\n        minWidth: \"10rem\",\n        flexDirection: \"column\",\n        padding: theme.spacing(3),\n        transition: theme.transitions.create(\"margin\", {\n            easing: theme.transitions.easing.sharp,\n            duration: theme.transitions.duration.leavingScreen,\n        }),\n        flexGrow: 1,\n    },\n}))\n\nexport default function MakeCodeEditorExtensionPage() {\n    const { toggleDarkMode, darkModeMounted } = useContext(DarkModeContext)\n    const rawTheme = createTheme({\n        palette: {\n            primary: {\n                main: \"#2e7d32\",\n            },\n            secondary: {\n                main: \"#ffc400\",\n            },\n            background: {\n                default: \"#fff\",\n            },\n            contrastThreshold: 5.1,\n            mode: \"light\",\n        },\n    })\n\n    const theme = responsiveFontSizes(rawTheme)\n    useEffect(() => {\n        if (darkModeMounted) toggleDarkMode(\"light\")\n    }, [darkModeMounted])\n    return (\n        <Root>\n            <ThemedLayout theme={theme}>\n                <div className={classes.content}>\n                    <PaperBox>\n                        <MakeCodeEditorExtension />\n                    </PaperBox>\n                </div>\n            </ThemedLayout>\n        </Root>\n    )\n}\n"],"names":["React","useMemo","useState","Menu","MenuItem","Typography","isInfrastructure","serviceSpecificationFromClassIdentifier","serviceSpecifications","AddIcon","IconButtonWithTooltip","useId","AddServiceIconButton","props","error","onAdd","children","serviceFilter","servicesAnchorEl","setServicesAnchorEl","servicesMenuId","services","filter","srv","handleServiceAddClick","event","currentTarget","handleServiceAddClose","id","undefined","Boolean","map","classIdentifier","toString","name","TextField","styled","useDeviceCatalog","PREFIX","classes","root","StyledTextField","minWidth","ServiceSpecificationSelect","label","serviceClass","setServiceClass","variant","fullWidth","hasRegisteredDevice","labelId","Math","random","deviceCatalog","specs","spec","test","shortId","specificationsForService","status","length","handleChange","parseInt","target","value","isNaN","Paper","PaperBox","padding","elevation","bgcolor","others","mb","p","useEffect","useClient","factory","deps","client","unmount","useContext","JDClient","CHANGE","CONNECT","inIFrame","JacdacContext","useEffectAsync","READ","MESSAGE_PACKET","HIDDEN","SHOWN","MakeCodeEditorExtensionClient","pendingCommands","extensionId","window","location","hash","substr","_connected","_visible","nextRequestId","handleMessage","bind","addEventListener","mount","removeEventListener","on","refresh","init","setVisible","vis","emit","mkRequest","resolve","reject","action","body","type","extId","response","sendRequest","log","Promise","msg","parent","postMessage","ev","data","_target","console","debug","success","resp","read","r","readUser","write","code","json","jres","dependencies","queryPermission","requestPermission","dataStreamConsole","dataStreamMessages","messages","useMakeCodeEditorExtensionClient","bus","stop","Grid","clone","JSONTryParse","uniqueName","useChange","DeleteIcon","CmdButton","SaveIcon","camelize","resolveMakecodeService","resolveMakecodeServiceFromClassIdentifier","toTypescript","config","ns","roles","role","service","qName","join","toDependencies","forEach","mk","repo","toJSON","JSON","stringify","escapeName","ClientRoleRow","component","onUpdate","nameError","serviceError","validateClientRole","textId","handleComponentNameChange","handleSetService","handleComponentDelete","splice","indexOf","MakeCodeEditorExtension","_","connected","c","configuration","setConfiguration","subscribe","cfg","hasMakeCodeService","mkc","targets","update","handleAddService","names","concat","camelName","n","push","handleSave","ts","i","createTheme","responsiveFontSizes","ThemedLayout","DarkModeContext","content","Root","theme","display","minHeight","flexDirection","spacing","transition","transitions","create","easing","sharp","duration","leavingScreen","flexGrow","MakeCodeEditorExtensionPage","toggleDarkMode","darkModeMounted","rawTheme","palette","primary","main","secondary","background","default","contrastThreshold","mode"],"sourceRoot":""}